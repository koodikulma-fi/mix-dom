!function(){function treeNodesWithin(e,t,n=0,o=!1,s=!1,r){const i=[];let a,l=[e],d=0;const c=e.boundary;for(;a=l[d];)if(d++,!a.boundary||null!==a.boundary.isMounted){if((!t||t.has(a.type))&&(!r||r(a))){const e=i.push(a);if(n&&e>=n)return i}a.boundary&&!o&&a.boundary!==c||('host'!==a.type||s)&&a.children[0]&&(l=a.children.concat(l.slice(d)),d=0)}return i}function rootDOMTreeNodes(e,t=!1,n=!1,o=0){let s=[];for(const r of e.children)if(r.domNode||n)switch(r.type){case'dom':if(s.push(r),o&&s.length>=o)return s;break;case'boundary':case'pass':case'host':if(!t)break;case'root':if(s=s.concat(rootDOMTreeNodes(r,t,n,o&&o-s.length)),o&&s.length>=o)return s.slice(0,o)}return s}function allDefsIn(e,t=!1){var n,o;const s=[];let r,i=[e],a=0;for(;r=i[a++];)r.updateId&&t&&r.updateId===(null===(o=null===(n=r.treeNode)||void 0===n?void 0:n.sourceBoundary)||void 0===o?void 0:o.host.services._whileUpdating)||s.push(r),r.childDefs[0]&&(i=r.childDefs.concat(i.slice(a)),a=0);return s}function domElementByQuery(e,t,n=!1,o=!1){const s=treeNodesWithin(e,new Set(['dom']),1,n,o,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t)))[0];return s&&s.domNode||null}function domElementsByQuery(e,t,n=0,o=!1,s=!1){return treeNodesWithin(e,new Set(['dom']),n,o,s,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t))).map((e=>e.domNode))}function lowerCaseStr(e,t='-'){return e.replace(/([A-Z])/g,t+'$1').toLowerCase()}function camelCaseStr(e,t='-'){return e.split(t).map(((e,t)=>e?t?e[0].toUpperCase()+e.slice(1):e:'')).join('')}function parseDOMStyle(e,t=!1){const n=e.replace(/\/\*(.|\s)*?\*\//g,' ').replace(/\s+/g,' ').trim();if(!n)return t?null:{};const o=n.split(';').map((e=>{const t=e.indexOf(':');return-1===t?[e.trim()]:[e.slice(0,t).trim(),e.slice(t+1).trim()]})),s={};for(const[e,n]of o)e&&n&&(s[e.replace(/\W+\w/g,(e=>e.slice(-1).toUpperCase()))]=(t=!1)||n);return t?null:s}function getNameDiffs(e,t,n=' '){if((e=e||'')===(t=t||''))return null;const o=n?e.split(n):[e],s=n?t.split(n):[t],r={};let i=null;if(o)for(const e of o)!e||s&&s.includes(e)||(r[e]=i=!1);if(s)for(const e of s)!e||o&&o.includes(e)||(r[e]=i=!0);return null!==i?r:null}function collectKeysTo(e,t,n=''){switch(typeof t){case'string':for(const o of n?t.split(n):[t])o&&(e[o]=!0);break;case'object':if(t[Symbol.iterator]&&'function'==typeof t[Symbol.iterator]){for(const o of t)if(o&&'string'==typeof o)for(const t of n?o.split(n):[o])t&&(e[t]=!0)}else for(const o in t)if(o&&t[o])for(const t of n?o.split(n):[o])t&&(e[t]=!0)}}function getDictionaryDiffs(e,t){const n={};let o=!1;for(const s in e)void 0!==e[s]&&void 0===t[s]&&(n[s]=(o=!0)&&void 0);for(const s in t){const r=t[s];e[s]!==r&&(n[s]=(o=!0)&&r)}return o?n:null}function equalSubDictionaries(e,t,...n){for(const o of n){if(!e[o]&&!t[o])continue;const n=e[o]||{},s=t[o]||{};if(n!==s){for(const e in n)if(s[e]!==n[e])return!1;for(const e in s)if(n[e]!==s[e])return!1}}return!0}function createDOMElement(e,t,n){return'svg'===e||t&&(!0===t||void 0!==t.ownerSVGElement)?document.createElementNS(n||'http://www.w3.org/2000/svg',e):document.createElement(e)}const e={innerHTML:!0,outerHTML:!0,textContent:!0,innerText:!0,outerText:!0},t=['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr'],n={autoCapitalize:'autocapitalize',autoFocus:'autofocus',contentEditable:'contenteditable',enterKeyHint:'enterkeyhint',exportParts:'exportparts',inputMode:'inputmode',itemId:'itemid',itemProp:'itemprop',itemRef:'itemref',itemScope:'itemscope',itemType:'itemtype',popOver:'popover',spellCheck:'spellcheck',tabIndex:'tabindex',virtualKeyboardPolicy:'virtualkeyboardpolicy',writingSuggestions:'writingsuggestions',acceptCharset:'accept-charset',autoComplete:'autocomplete',autoPlay:'autoplay',bgColor:'bgcolor',colSpan:'colspan',crossOrigin:'crossorigin',dateTime:'datetime',dirName:'dirname',encType:'enctype',formAction:'formaction',formEncType:'formenctype',formMethod:'formmethod',formNoValidate:'formnovalidate',formTarget:'formtarget',hrefLang:'hreflang',httpEquiv:'http-equiv',isMap:'ismap',maxLength:'maxlength',minLength:'minlength',noValidate:'novalidate',playsInline:'playsinline',readOnly:'readonly',referrerPolicy:'referrerpolicy',rowSpan:'rowspan',srcDoc:'srcdoc',srcLang:'srclang',srcSet:'srcset',useMap:'usemap',xmlBase:'xml:base',xmlLang:'xml:lang',xmlSpace:'xml:space',xmlnsXlink:'xmlns:xlink',accentHeight:'accent-height',alignmentBaseline:'alignment-baseline',allowReorder:'allow-reorder',arabicForm:'arabic-form',baselineShift:'baseline-shift',capHeight:'cap-height',clipPath:'clip-path',clipRule:'clip-rule',colorInterpolation:'color-interpolation',colorInterpolationFilters:'color-interpolation-filters',colorRendering:'color-rendering',dominantBaseline:'dominant-baseline',fillOpacity:'fill-opacity',fillRule:'fill-rule',floodColor:'flood-color',floodOpacity:'flood-opacity',fontFamily:'font-family',fontSize:'font-size',fontSizeAdjust:'font-size-adjust',fontStretch:'font-stretch',fontStyle:'font-style',fontVariant:'font-variant',fontWeight:'font-weight',glyphName:'glyph-name',glyphOrientationHorizontal:'glyph-orientation-horizontal',glyphOrientationVertical:'glyph-orientation-vertical',horizAdvX:'horiz-adv-x',horizOriginX:'horiz-origin-x',horizOriginY:'horiz-origin-y',imageRendering:'image-rendering',letterSpacing:'letter-spacing',lightingColor:'lighting-color',markerEnd:'marker-end',markerMid:'marker-mid',markerStart:'marker-start',overlinePosition:'overline-position',overlineThickness:'overline-thickness',paintOrder:'paint-order',pointerEvents:'pointer-events',shapeRendering:'shape-rendering',stopColor:'stop-color',stopOpacity:'stop-opacity',strokeDashArray:'stroke-dasharray',strokeDashOffset:'stroke-dashoffset',strokeLineCap:'stroke-linecap',strokeLineJoin:'stroke-linejoin',strokeMiterLimit:'stroke-miterlimit',strokeOpacity:'stroke-opacity',strokeWidth:'stroke-width',textAnchor:'text-anchor',textDecoration:'text-decoration',textRendering:'text-rendering',transformOrigin:'transform-origin',underlinePosition:'underline-position',underlineThickness:'underline-thickness',unicodeBidi:'unicode-bidi',unicodeRange:'unicode-range',unitsPerEm:'units-per-em',vAlphabetic:'v-alphabetic',vHanging:'v-hanging',vIdeographic:'v-ideographic',vMathematical:'v-mathematical',vectorEffect:'vector-effect',vertAdvY:'vert-adv-y',vertOriginX:'vert-origin-x',vertOriginY:'vert-origin-y',wordSpacing:'word-spacing',writingMode:'writing-mode',xlinkActuate:'xlink:actuate',xlinkArcrole:'xlink:arcrole',xlinkHref:'xlink:href',xlinkRole:'xlink:role',xlinkShow:'xlink:show',xlinkTitle:'xlink:title',xlinkType:'xlink:type'},o=['abort','activate','animationcancel','animationend','animationiteration','animationstart','auxclick','beforeinput','beforetoggle','begin','blur','cancel','canplay','canplaythrough','change','click','close','contextlost','contextmenu','contextrestored','copy','cuechange','cut','dblclick','drag','dragend','dragenter','dragleave','dragover','dragstart','drop','durationchange','emptied','ended','error','focus','focusin','focusout','formdata','gotpointercapture','input','invalid','keydown','keypress','keyup','load','loadeddata','loadedmetadata','loadstart','lostpointercapture','mousedown','mouseenter','mouseleave','mousemove','mouseout','mouseover','mouseup','mousewheel','paste','pause','play','playing','pointercancel','pointerdown','pointerenter','pointerleave','pointermove','pointerout','pointerover','pointerup','progress','ratechange','repeat','reset','resize','scroll','scrollend','securitypolicyviolation','seeked','seeking','select','selectionchange','selectstart','show','slotchange','stalled','submit','suspend','timeupdate','toggle','touchcancel','touchend','touchmove','touchstart','transitioncancel','transitionend','transitionrun','transitionstart','unload','volumechange','waiting','webkitanimationend','webkitanimationiteration','webkitanimationstart','webkittransitionend','wheel'].reduce(((e,t)=>(e['on'+t]=t,e)),{}),s={class:!0,className:!0,style:!0};function readDOMProps(e){var t;const n={};if(!(e instanceof Element))return n;for(const o of e.getAttributeNames())switch(o){case'style':{const t=parseDOMStyle(e.style.cssText,!0);t&&(n.style=t);break}case'class':n.className=e.className;break;default:o.startsWith('data-')?(n.data=n.data||{},n.data[camelCaseStr(o.slice(5))]=e.getAttribute(o)):(n.attributes=n.attributes||{},n.attributes[o]=null!==(t=e.getAttribute(o))&&void 0!==t?t:void 0)}return n}function cleanDOMProps(e,t=o,r=n){var i;const a={};let l;for(const n in e)if(s[n])if('style'===n){const t='string'==typeof e.style?parseDOMStyle(e.style):e.style||{};for(const e in t){a.style=t;break}}else e[n]&&(a.className=a.className?a.className+' '+e[n]:e[n]);else if(l=t[n.toLowerCase()]){if(!e[n])continue;a.listeners=a.listeners||{},a.listeners[l]=null!==(i=e[n])&&void 0!==i?i:void 0}else if(n.startsWith('data'))'-'===n[4]?(a.data=a.data||{},a.data[camelCaseStr(n.slice(5))]=e[n]):a.data=Object.assign(Object.assign({},a.data),e.data);else{if(void 0===e[n])continue;a.attributes=a.attributes||{},a.attributes[r[n]||n.startsWith('aria')&&'-'!==n[4]&&'aria-'+n.slice(4).toLowerCase()||n]=e[n]}return a}function equalDOMProps(e,t){return(e.className||'')===(t.className||'')&&equalSubDictionaries(e,t,'style','data','listeners','attributes')}function applyDOMProps(t,n,o={},s=!0,r=e){var i,a;const l={},d=(o.style||n.style?1:0)|(o.data||n.data?2:0);if(d)for(const e of 1===d?['style']:2===d?['data']:['style','data']){const s=getDictionaryDiffs(o[e]||{},n[e]||{});if(s&&(l[e]=s),s&&t)if('data'===e){const e=t.dataset;if(e)for(const t in s)void 0!==s[t]?e[t]=s[t]:delete e[t]}else{const e=t.style;if(e)for(const t in s)e[t]=null!==(i=s[t])&&void 0!==i?i:null}}if(o.className||n.className){const e=getNameDiffs(o.className,n.className);if(e&&(l.className=e),e&&t)for(const n in e)t.classList[e[n]?'add':'remove'](n)}if(o.attributes||n.attributes){const e=getDictionaryDiffs(o.attributes||{},n.attributes||{});if(e&&(l.attributes=e),e&&t)for(const n in e)r[n]?s&&console.warn('Warning: Tried to apply a protected attribute: ',n,' for element: ',t):void 0===e[n]?t.removeAttribute(n):t.setAttribute(n,e[n])}if(o.listeners||n.listeners){const e=getDictionaryDiffs(o.listeners||{},n.listeners||{});if(e&&(l.attributes=e),e&&t)for(const n in e){const s=null===(a=o.listeners)||void 0===a?void 0:a[n];s&&t.removeEventListener(n,s),e[n]&&t.addEventListener(n,e[n])}}for(const e in l)return l;return null}function readDOMString(t,n,s,r,i=e){let a='';if(n||(n={}),!t&&(r&&r instanceof Element&&(t=r.tagName.toLowerCase()||''),!t))return(r&&r.textContent||'')+(!0===s?'':s||'');if(r){const{className:e,style:t,data:o,attributes:s}=readDOMProps(r);if(e&&(n.className=n.className?n.className+' '+e:e),t){n.style=n.style||{};for(const e in t)n.style[e]=t[e]}if(o){n.data=n.data||{};for(const e in o)n.data[e]=o[e]}for(const e in s)n[e]=s[e]}const{className:l,style:d,data:c,attributes:u}=n;if(a+='<'+t,l&&(a+=' class="'+l+'"'),d){let e='';for(const t in d)e+=(e?' ':'')+lowerCaseStr(t)+': '+d[t]+';';e&&(a+=' style="'+e+'"')}if(c)for(const e in c)a+=' data-'+lowerCaseStr(e)+'="'+c[e].toString()+'"';if(u)for(let e in u)!u[e]||i[e]||o[e.toLowerCase()]||(a+=' '+e+'="'+u[e].toString()+'"');return s?(a+='>',!0!==s&&(a+=s),a+='</'+t+'>'):a+='/>',a}var r=Object.freeze({__proto__:null,applyDOMProps,camelCaseStr,classNames:function classNames(...e){let t='';for(const n of e)n&&('string'==typeof n?t+=' '+n:n[Symbol.iterator]&&'function'==typeof n[Symbol.iterator]?t+=' '+[...n].filter((e=>e)).join(' '):n&&'object'==typeof n&&(t+=' '+Object.keys(n).filter((e=>n[e])).join(' ')));return t.trimStart().replace(/\s+/g,' ')},cleanDOMProps,cleanNames:function cleanNames(...e){const t={};for(const n of e)n&&collectKeysTo(t,n,' ');return Object.keys(t).join(' ')},collectKeysTo,createDOMElement,domListenerProps:o,domRenamedAttributes:n,domSelfClosingTags:t,domSkipAttributes:e,equalDOMProps,equalSubDictionaries,getDictionaryDiffs,getNameDiffs,isNodeSVG:function isNodeSVG(e){return e&&void 0!==e.ownerSVGElement||!1},lowerCaseStr,parseDOMStyle,readDOMProps,readDOMString}),__rest=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n};const i={};function newDef(e,t=null,...n){const o=function parseDefType(e){if('string'==typeof e)return'_'===e?'element':'dom';if(!e)return'';const t=e.MIX_DOM_CLASS;if(!t)return'function'==typeof e?e.length>=2?'boundary':'spread':'';switch(t){case'Component':case'Remote':return'boundary';case'Fragment':case'Portal':case'Element':case'Host':return t.toLowerCase();default:return''}}(e);if(!o||t&&t._disable)return null;const s=[];let r=!1,i=0;for(const e of n){let t='string'==typeof e;if(e&&t&&r){s[i-1].domContent+=e;continue}const n=newDefFrom(e);n&&(i=s.push(n),r=t)}if('spread'===o)return function unfoldSpread(e,t,n){var o;const{_key:s,_disable:r}=t,i=__rest(t,['_key','_disable']);let a=newDefFrom(e(i));if(!a)return null;const l={passes:[],withs:[]},d={MIX_DOM_DEF:'fragment',childDefs:[Object.assign({},a)],scopeType:'spread',spreadLinks:l,tag:null};null!=s&&(d.key=s);null!=r&&(d.disabled=r);let c,u=[d],h=!1,p=0;const m=!!n[0];for(;c=u[p];){if(p++,!c.childDefs[0])continue;let e=[];const t=c.childDefs;c.childDefs=[];for(const s of t){let t;if(s.spreadLinks){t=s,e=e.concat(s.spreadLinks.passes);for(const[e,t]of s.spreadLinks.withs){const n=e&&hasContentInDefs(e,m);'maybe'!==n&&(t.props.hasContent=n),'maybe'===n&&l.withs.push([e,t])}}else if('pass'===s.MIX_DOM_DEF)s.getRemote?t=s:(t={MIX_DOM_DEF:'fragment',tag:null,childDefs:[...n]},null!=s.key&&(t.key=s.key),h||'copy'===s.contentPassType?t.scopeType='spread-copy':(t.scopeType='spread-pass',h=!0),l.passes.push(t));else if(t=Object.assign({},s),e.push(t),'boundary'===s.MIX_DOM_DEF&&s.tag._WithContent&&!s.tag._WithContent.getRemote&&!s.tag.withContents&&null==(null===(o=t.props)||void 0===o?void 0:o.hasContent)){const e=hasContentInDefs(n,m);t.props=Object.assign({hasContent:'maybe'===e?void 0:e},t.props),'maybe'===e&&l.withs.push([n,t])}c.childDefs.push(t)}u=e.concat(u.slice(p)),p=0}return d}(e,t||{},s);if('fragment'===o&&!s[0])return null;const a='dom'===o&&e||'boundary'===o&&e||'element'===o&&'_'||('content'===o?'':null),l={MIX_DOM_DEF:o,tag:a,childDefs:s};if('fragment'===l.MIX_DOM_DEF);else if(t){const{_key:e,_ref:n,_signals:s,_contexts:r,_disable:i}=t,d=__rest(t,['_key','_ref','_signals','_contexts','_disable']);if(null!=e&&(l.key=e),n){const e=[];if('Ref'===n.constructor.MIX_DOM_CLASS)e.push(n);else for(const t of n)t&&'Ref'===t.constructor.MIX_DOM_CLASS&&-1===e.indexOf(t)&&e.push(t);l.attachedRefs=e}s&&(l.attachedSignals=Object.assign({},s)),r&&'boundary'===o&&(l.attachedContexts=Object.assign({},r)),a&&(l.props='string'==typeof a?cleanDOMProps(d):d)}else a&&(l.props={});switch(l.MIX_DOM_DEF){case'portal':l.domPortal=t.container||null;break;case'element':{const e=l.props||{},{element:t,cloneMode:n}=e,o=__rest(e,['element','cloneMode']);l.props=cleanDOMProps(o),l.domElement=t||null,l.domCloneMode=null!=n?'boolean'==typeof n?n?'deep':'':n:null;break}}return l}function newDefFrom(e){if(e&&'object'==typeof e){if('string'==typeof e.MIX_DOM_DEF)return e;if(e instanceof Node)return{MIX_DOM_DEF:'content',tag:'',childDefs:[],domContent:e};if('Host'===e.constructor.MIX_DOM_CLASS)return{MIX_DOM_DEF:'host',tag:null,host:e,key:e,childDefs:[]};if(Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList){const t=[...e].map((e=>newDefFrom(e))).filter((e=>e));return t.length?{MIX_DOM_DEF:'fragment',tag:null,isArray:!0,childDefs:t}:null}e=String(e)}return null!=e?{MIX_DOM_DEF:'content',tag:'',domContent:e,childDefs:[]}:null}function newAppliedDef(e,t){const n={MIX_DOM_DEF:e.MIX_DOM_DEF,tag:e.tag,childDefs:[],action:'mounted'};return null!=e.key&&(n.key=e.key),'fragment'===n.MIX_DOM_DEF?(e.isArray&&(n.isArray=!0),e.scopeType&&(n.scopeType=e.scopeType)):'pass'===n.MIX_DOM_DEF?e.getRemote?(n.getRemote=e.getRemote,n.contentPass=e.contentPass||null):n.contentPass=e.contentPass||t||null:e.host&&(n.host=e.host),n}function newContentPassDef(e,t){const n={MIX_DOM_DEF:'pass',tag:null,childDefs:[],contentPassType:t?'copy':'pass'};return null!=e?n.key=e:t||(n.key=i),n}const checkRecursively$1=e=>e.contentPass&&e.contentPass.envelope&&hasContentInDefs(e.contentPass.envelope.applied.childDefs,checkRecursively$1)||!1;function hasContentInDefs(e,t=checkRecursively$1){let n=!1;for(const o of e){if(o.disabled)continue;const e='fragment'===o.MIX_DOM_DEF?hasContentInDefs(o.childDefs,t):'pass'!==o.MIX_DOM_DEF||('function'==typeof t?t(o):t&&'maybe');if(e){if(!0===e)return!0;n=!0}}return n&&'maybe'}const a=newContentPassDef(),l=newContentPassDef({},!0);var d;function callListeners(e,t){for(const n of e.slice()){const o=n[2]||0;if(o&d.OneShot){const t=n[4]||e,o=t.indexOf(n);-1!==o&&t.splice(o,1)}o&d.Deferred?setTimeout((()=>n[0](...n[1]&&t?[...t,...n[1]]:t||n[1]||[])),0):n[0](...n[1]&&t?[...t,...n[1]]:t||n[1]||[])}}!function(e){e[e.OneShot=1]='OneShot',e[e.Deferred=2]='Deferred',e[e.None=0]='None',e[e.All=3]='All'}(d||(d={}));class SignalBoy extends(mixinSignalBoy(Object)){}function mixinSignalBoy(e){return class SignalBoy extends e{constructor(){super(...arguments),this.signals={}}listenTo(e,t,n,o=d.None,s){var r,i;let a=this.signals[e];const l=[t,n||null,o||d.None,null!=s?s:null];a?a.some(((e,n)=>e[0]===t&&(a[n]=l)))||a.push(l):this.signals[e]=a=[l],l[2]&d.OneShot&&l.push(a),null===(i=(r=this.constructor).onListener)||void 0===i||i.call(r,this,e,a.indexOf(l),!0)}unlistenTo(e,t,n){var o,s;null==e?e=Object.keys(this.signals):'string'==typeof e&&(e=[e]);const r=null!=n;for(const i of e){const e=this.signals[i];if(e){for(let a=e.length-1;a>=0;a--)t&&e[a][0]!==t||r&&e[a][3]!==n||(null===(s=(o=this.constructor).onListener)||void 0===s||s.call(o,this,i,a,!1),e.splice(a,1));e[0]||delete this.signals[i]}}}isListening(e,t,n){if(null==e)return Object.keys(this.signals).some((e=>this.isListening(e,t,n)));const o=this.signals[e];return!(!o||t&&!o.some((e=>e[0]===t))||null!=n&&!o.some((e=>e[3]===n)))}sendSignal(e,...t){const n=this.constructor.getListenersFor?this.constructor.getListenersFor(this,e):this.signals[e];n&&callListeners(n,t)}static onListener(e,t,n,o){}}}function askListeners(e,t,n){const o=n&&(n.includes('first')||n.includes('first-true')),s=n&&(o||n.includes('last')),r=n&&n.includes('no-false'),i=n&&n.includes('no-null');let a=[];for(const l of e.slice()){const c=l[2]||0;if(c&d.OneShot){const t=l[4]||e,n=t.indexOf(l);-1!==n&&t.splice(n,1)}if(c&d.Deferred)setTimeout((()=>l[0](...l[1]&&t?[...t,...l[1]]:t||l[1]||[])),0);else{const e=l[0](...l[1]&&t?[...t,...l[1]]:t||l[1]||[]);if(!e&&(void 0===e||r||i&&null==e))continue;if(s?a[0]=e:a.push(e),o&&(e||!n.includes('first-true')))break}}return s?a[0]:a}class SignalMan extends(mixinSignalMan(Object)){}function mixinSignalMan(e){return class SignalMan extends(mixinSignalBoy(e)){sendSignalAs(e,t,...n){const o='string'==typeof e?[e]:e,s=o.includes('delay')||o.includes('pre-delay'),r=o.includes('first')||o.includes('first-true'),i=o.includes('multi')||!r&&!o.includes('last');if(o.includes('await'))return new Promise((async e=>{s&&await this.afterRefresh(o.includes('delay'));const a=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];if(!a)return e(i?[]:void 0);let l=(await Promise.all(askListeners(a,n))).filter((e=>!(void 0===e||null==e&&o.includes('no-null')||!e&&o.includes('no-false'))));r&&o.includes('first-true')&&(l=l.filter((e=>e)));const d=l.length;d?r?e(i?[l[0]]:l[0]):o.includes('last')?e(i?[l[d-1]]:l[d-1]):e(l):e(i?[]:void 0)}));if(!s){const e=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];return e?askListeners(e,n,o):o.includes('last')||r?void 0:[]}(async()=>{await this.afterRefresh(o.includes('delay'));const e=this.constructor.getListenersFor?this.constructor.getListenersFor(this,t):this.signals[t];e&&(r?askListeners(e,n,o):callListeners(e,n))})()}afterRefresh(e=!1){return new Promise((t=>setTimeout(e&&this.awaitDelay?async()=>{await this.awaitDelay(),t()}:t,0)))}}}class DataBoy extends(mixinDataBoy(Object)){}function mixinDataBoy(e){return class DataBoy extends e{constructor(){super(...arguments),this.dataListeners=new Map}listenToData(...e){var t;let n=1;const o=e.length,s='boolean'==typeof e[o-n]&&e[o-n++],r='object'==typeof e[0],i=r?e[0]:Array.isArray(e[o-n])?null===(t=e[o-n++])||void 0===t?void 0:t.slice():void 0,a=r?Object.keys(e[0]):e.slice(0,o-n),l=e[o-n];this.dataListeners.set(l,[i,...a]),s&&l(...this.getDataArgsBy(a,i))}unlistenToData(e){return!!this.dataListeners.has(e)&&(this.dataListeners.delete(e),!0)}getInData(e,t){return t}setInData(e,t,n,o){}refreshData(e,t){e&&('string'==typeof e&&(e=[e]),null!=t?setTimeout((()=>this.callDataBy(e))):this.callDataBy(e))}getDataArgsBy(e,t){return t?Array.isArray(t)?e.map(((e,n)=>this.getInData(e,t[n]))):[e.reduce(((e,n)=>(e[n]=this.getInData(n,t[n]),e)),{})]:e.map(((e,t)=>this.getInData(e)))}callDataBy(e=!0,t){if(t||!this.constructor.callDataListenersFor)for(const[t,[n,...o]]of this.dataListeners.entries())(!0===e||e.some((e=>o.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...this.getDataArgsBy(o,n));else this.constructor.callDataListenersFor(this,e)}}}class DataMan extends(mixinDataMan(Object)){constructor(e){super(e)}}function mixinDataMan(e){return class DataMan extends(mixinDataBoy(e)){constructor(...e){super(...e.slice(1)),this.dataListeners=new Map,this.dataKeysPending=null,this.data=e[0]||{}}getData(){return this.data}getInData(e,t){if(!this.data)return t;if(!e)return this.data;const n=e.split('.');let o=this.data;for(const e of n){if(!o)return t;o=o[e]}return void 0===o?t:o}setData(e,t=!0,n=!0,o){this.data=!1!==t?Object.assign(Object.assign({},this.data),e):e,n?this.refreshData(!0,o):this.addRefreshKeys(!0)}setInData(e,t,n=!0,o=!0,s){var r;if(e){const o=e.split('.'),s=o.pop();if(!s)return;const i=this.constructor.createPathTo(this,o);if(!i)return;i[s]=n&&(null===(r=i[s])||void 0===r?void 0:r.constructor)===Object?Object.assign(Object.assign({},i[s]),t):t}else this.data=n&&this.data?Object.assign(Object.assign({},this.data),t):t;o?this.refreshData(e||!0,s):this.addRefreshKeys(e||!0)}refreshData(e,t){if(e&&this.addRefreshKeys(e),null!=t)return void setTimeout((()=>this.refreshData(null)),t);const n=this.dataKeysPending;this.dataKeysPending=null,n&&this.callDataBy(n)}addRefreshKeys(e){if(!0===e)this.dataKeysPending=!0;else if(e&&!0!==this.dataKeysPending)if('string'==typeof e&&(e=[e]),this.dataKeysPending)for(const t of e)this.dataKeysPending.some((e=>e===t||t.startsWith(e+'.')))||this.dataKeysPending.push(t);else this.dataKeysPending=[...e]}static createPathTo(e,t){var n;let o=e.data=Object.assign({},e.data);for(const e of t)o=o[e]=(null===(n=o[e])||void 0===n?void 0:n.constructor)===Object?Object.assign({},o[e]):o[e]||{};return o}}}class RefreshCycle extends SignalBoy{constructor(...e){super(),this.state='',this.settings=e[0]||{},this.settings.autoRenewPromise?this.initPromise():this.promise=Promise.resolve(),this.pending=this.settings.initPending?this.settings.initPending():void 0}start(e){if(this.state)return;const t=this.signals;this.setState('waiting'),this._resolve&&this.settings.autoRenewPromise||this.initPromise();const n=void 0===e?void 0===this.nextTimeout?this.settings.defaultTimeout:this.nextTimeout:e;this.extend(n),t.onStart&&this.sendSignal('onStart'),null===n&&this.resolve()}trigger(e,t){const n=void 0===t?void 0===this.nextTimeout?e:this.nextTimeout:t;return this.state?void 0!==n&&this.extend(n,'instant'):this.start(n),this.promise}extend(e,t){switch(this.state){case'':void 0===e?delete this.nextTimeout:this.nextTimeout=e,(!0===t||t&&null===e)&&this.start();break;case'waiting':this.clearTimer(),null===e?t?this.resolve():this.nextTimeout=null:void 0!==e&&(this.timer=setTimeout((()=>{delete this.timer,this.resolve()}),e))}}clearTimer(){delete this.nextTimeout,void 0!==this.timer&&(clearTimeout(this.timer),delete this.timer)}resetPending(){const e=this.pending;return this.pending=this.settings.initPending?this.settings.initPending():void 0,e}resolve(){if('waiting'!==this.state)return;this.setState('resolving'),this.clearTimer();const e=this.resetPending(),t=this.signals;t.onResolve&&this.sendSignal('onResolve');let n=0;const resolvePromise=(e=!1)=>{1&n?e||2&n||'resolving'!==this.state||(n|=2,this.setState(''),this._resolve&&this._resolve()):(n|=e?1:3,e||'resolving'!==this.state||this.setState(''),this._resolve&&this._resolve())};t.onRefresh&&this.sendSignal('onRefresh',e,resolvePromise),resolvePromise(),this.settings.autoRenewPromise&&this.initPromise(),t.onFinish&&this.sendSignal('onFinish',!1)}reject(){if('waiting'!==this.state)return;this.setState('resolving'),this.clearTimer(),this.resetPending();const e=this.signals;e.onResolve&&this.sendSignal('onResolve'),this.setState(''),this.settings.autoRenewPromise?this.initPromise():this._resolve&&this._resolve(),e.onFinish&&this.sendSignal('onFinish',!0)}initPromise(){this._resolve&&this._resolve(),this.promise=new Promise((e=>this._resolve=()=>{delete this._resolve,e()}))}setState(e){this.state=e,this.signals.onState&&this.sendSignal('onState',this.state)}}class Context extends(mixinDataMan(mixinSignalMan(Object))){constructor(e,t){super(e),this.settings=this.constructor.getDefaultSettings(),this.contextAPIs=new Map,this.preDelayCycle=new RefreshCycle,this.delayCycle=new RefreshCycle({autoRenewPromise:!0}),t&&this.modifySettings(t),this.constructor.initializeCyclesFor(this)}modifySettings(e){var t;const n=this.constructor.getDefaultSettings();for(const o in e)this.settings[o]=void 0!==e[o]?e[o]:null!==(t=this.settings[o])&&void 0!==t?t:n[o]}triggerRefresh(e){this.preDelayCycle.trigger(this.settings.refreshTimeout,e)}afterRefresh(e=!1,t){return e&&this.delayCycle.state||this.preDelayCycle.trigger(this.settings.refreshTimeout,t),e?this.delayCycle.promise:this.preDelayCycle.promise}async awaitDelay(){const e=new Set;for(const t of this.contextAPIs.keys())e.add(t.afterRefresh(!0));await Promise.all(e)}refreshData(e,t){e&&this.addRefreshKeys(e),this.triggerRefresh(t)}static getListenersFor(e,t){let n=e.signals[t]||[];for(const[o,s]of e.contextAPIs)for(const e of s){const s=o.constructor.getListenersFor?o.constructor.getListenersFor(o,e+'.'+t):o.signals[e+'.'+t];s&&(n=n.concat(s))}return n[0]&&n}static createPathTo(e,t){switch(e.settings.dataMode){case'immutable':return super.createPathTo(e,t);case'mutable':{let n=e.data;for(const e of t)n=n[e]=n[e]?n[e]:{};return n}case'existing':{let n=e.data;for(const e of t){if(!n[e])return;n=n[e]}return n}default:return}}static getDefaultSettings(){return{refreshTimeout:0,dataMode:'immutable'}}static initializeCyclesFor(e){e.preDelayCycle.listenTo('onRefresh',((t,n)=>e.constructor.runPreDelayFor(e,n))),e.delayCycle.listenTo('onRefresh',((t,n)=>e.constructor.runDelayFor(e,n))),e.preDelayCycle.listenTo('onFinish',(()=>{e.delayCycle.trigger(),'waiting'===e.delayCycle.state&&(e.awaitDelay?e.awaitDelay().then((()=>e.delayCycle.resolve())):e.delayCycle.resolve())})),e.delayCycle.listenTo('onResolve',(()=>e.preDelayCycle.resolve()))}static runPreDelayFor(e,t){const n=e.dataKeysPending;if(e.dataKeysPending=null,t(),n){for(const[t,[o,...s]]of e.dataListeners.entries())(!0===n||n.some((e=>s.some((t=>t===e||t.startsWith(e+'.')||e.startsWith(t+'.'))))))&&t(...e.getDataArgsBy(s,o));for(const[t,o]of e.contextAPIs.entries())t.callDataBy(!0===n?o:o.reduce(((e,t)=>e.concat(n.map((e=>e?t+'.'+e:t)))),[]))}}static runDelayFor(e,t){}}const createContexts=(e,t)=>{const n={};for(const o in e)n[o]=new Context(e[o],t);return n};class ContextAPI extends(mixinDataBoy(mixinSignalMan(Object))){constructor(e,t){super(),this.contexts=Object.assign({},e),t&&(this.inheritedContexts=Object.assign({},t)),this.dataListeners=new Map}afterRefresh(e=!1,t){return this.awaitDelay?this.awaitDelay():Promise.resolve()}sendSignal(e,...t){var n;const o=e.indexOf('.');-1!==o&&(null===(n=this.getContext(e.slice(0,o)))||void 0===n||n.sendSignal(e.slice(o+1),...t))}sendSignalAs(e,t,...n){const o=t.indexOf('.'),s=-1===o?null:this.getContext(t.slice(0,o));if(s)return s.sendSignalAs(e,t.slice(o+1),...n);const r='string'==typeof e?[e]:e,i=r.includes('last')||r.includes('first')||r.includes('first-true')?void 0:[];return r.includes('await')?Promise.resolve(i):i}getInData(e,t){const n=e.indexOf('.'),o=this.getContext(-1===n?e:e.slice(0,n));return o?-1===n?o.getData():o.getInData(e.slice(n+1),t):t}setInData(e,t,n,o,s){const r=e.indexOf('.'),i=this.getContext(-1===r?e:e.slice(0,r));i&&(-1===r?i.setData(t,n,o,s):i.setInData(e.slice(r+1),t,n,o,s))}refreshData(e,t){if(!e)return;const n={};for(const t of!0===e?Object.keys(this.getContexts()):'string'==typeof e?[e]:e){const e=t.indexOf('.'),o=-1===e?t:t.slice(0,e);let s=n[o];void 0===s&&(s=n[o]=this.getContext(o)||null),s&&s.addRefreshKeys(-1===e||t.slice(o.length+1))}for(const e in n)n[e]&&n[e].refreshData(null,t)}refreshDataBy(e,t){const n=this.getContexts(e);for(const o in n){const s=n[o];s&&s.refreshData(e[o],t)}}getContext(e,t=!0){return void 0!==this.contexts[e]?this.contexts[e]:t&&this.inheritedContexts?this.inheritedContexts[e]:void 0}getContexts(e,t=!0,n=!1){if(!e)return Object.assign(Object.assign({},t?this.inheritedContexts:void 0),this.contexts);const o=e.constructor===Set?e:e.constructor===Array?new Set(e):new Set(Object.keys(e)),s={},r=t&&this.inheritedContexts?Object.assign(Object.assign({},this.inheritedContexts),this.contexts):this.contexts;for(const e in r)!o.has(e)||void 0===r[e]||n&&null===r[e]||(s[e]=r[e]);return s}newContext(e,t,n,o=!0){const s=new Context(e,t);return n&&this.setContext(n,s,o),s}newContexts(e,t,n=!1,o=!0){const s=createContexts(e,t);return n&&this.setContexts(s,o),s}setContext(e,t,n=!0,o=!1){return void 0!==this.constructor.modifyContexts(this,{[e]:t},n,o)[0]}setContexts(e,t=!0,n=!1){return this.constructor.modifyContexts(this,e,t,n)}refreshContext(e,t){var n;null===(n=this.getContext(e))||void 0===n||n.triggerRefresh(t)}refreshContexts(e,t){if(!e||Array.isArray(e))for(const n of e||Object.keys(this.getContexts()))this.refreshContext(n,t);else for(const n in e)this.refreshContext(n,void 0===e[n]?t:e[n])}static modifyContexts(e,t,n,o){let s=[];for(const n in t){const r=t[n],i=e.getContext(n),a=o?e.inheritedContexts||(e.inheritedContexts={}):e.contexts;if(i===r){(o?(e.inheritedContexts&&e.inheritedContexts[n])!==r:e.contexts[n]!==r)&&(void 0!==r?a[n]=r:delete a[n]);break}if(i){const t=i.contextAPIs.get(e);if(t){const o=t.filter((e=>e!==n));o.length?i.contextAPIs.set(e,o):i.contextAPIs.delete(e)}}if(r){const t=r.contextAPIs.get(e)||[];t.includes(n)||t.push(n),r.contextAPIs.set(e,t)}void 0!==r?a[n]=r:delete a[n],s.push(n)}return n&&void 0!==s[0]&&e.callDataBy(s),s}static parseContextDataKey(e){const t=e.indexOf('.');return-1===t?[e,'']:[e.slice(0,t),e.slice(t+1)]}static readContextNamesFrom(e,t){return e.reduce(((e,n)=>{const o=n.indexOf('.'),s=-1===o?n:n.slice(0,o);return(t||s&&!e.includes(s))&&e.push(s),e}),[])}static readContextDictionaryFrom(e){const t={};for(const n of e){const[e,o]=ContextAPI.parseContextDataKey(n);!0!==t[e]&&(o?(t[e]||(t[e]=[])).push(o):t[e]=!0)}return t}}var c=Object.freeze({__proto__:null,Context,ContextAPI,DataBoy,DataMan,RefreshCycle,SignalBoy,get SignalListenerFlags(){return d},SignalMan,askListeners,callListeners,createContexts,mixinDataBoy,mixinDataMan,mixinSignalBoy,mixinSignalMan});class Ref extends SignalBoy{constructor(...e){super(...e),this.treeNodes=new Set}getTreeNode(){return[...this.treeNodes][this.treeNodes.size-1]||null}getTreeNodes(){return[...this.treeNodes]}getElement(e=!1){let t=this.treeNodes.size-1;const n=[...this.treeNodes];for(;t>=0;){const o=n[t];if(o.domNode&&(!e||'dom'===o.type))return o.domNode}return null}getElements(e=!1){let t=[];for(const n of this.treeNodes)n.domNode&&('dom'===n.type?t.push(n.domNode):e||(t=t.concat(rootDOMTreeNodes(n,!0).map((e=>e.domNode)))));return t}getComponent(){var e;const t=[...this.treeNodes][this.treeNodes.size-1];return t&&'boundary'===t.type&&(null===(e=t.boundary)||void 0===e?void 0:e.component)||null}getComponents(){var e;const t=[];for(const n of this.treeNodes)'boundary'===n.type&&(null===(e=n.boundary)||void 0===e?void 0:e.component)&&t.push(n.boundary.component);return t}static onListener(e,t,n,o){if(e.treeNodes.size&&e.signals[t]){const s=e.signals[t][n],r=s[0];if(o)for(const n of e.getComponents())n.listenTo(t,((...e)=>s[1]?r(n,...e,...s[1]):r(n,...e)),null,s[2],r);else for(const n of e.getComponents())n.unlistenTo(t,r)}}static didAttachOn(e,t){var n;if(!e.treeNodes.has(t))if(e.treeNodes.add(t),'boundary'===t.type){const o=null===(n=t.boundary)||void 0===n?void 0:n.component;for(const t in e.signals)for(const n of e.signals[t]){const[e,s,r]=n;o.listenTo(t,((...t)=>s?e(o,...t,...s):e(o,...t)),null,r,e)}o&&e.signals.didAttach&&callListeners(e.signals.didAttach,[o])}else'dom'===t.type&&t.domNode&&e.signals.domDidAttach&&callListeners(e.signals.domDidAttach,[t.domNode])}static willDetachFrom(e,t){var n;if(e.treeNodes.has(t))if('boundary'===t.type){const o=null===(n=t.boundary)||void 0===n?void 0:n.component;if(o){e.signals.willDetach&&callListeners(e.signals.willDetach,[o]);for(const t in e.signals)for(const n of e.signals[t])o.unlistenTo(t,n[0])}}else'dom'===t.type&&t.domNode&&e.signals.domWillDetach&&callListeners(e.signals.domWillDetach,[t.domNode]);e.treeNodes.delete(t)}}Ref.MIX_DOM_CLASS='Ref';class HostRender{constructor(e,t){this.assimilationRoot=t||null,this.paused=e.disableRendering,this.settings=e,this.externalElements=new Set,this.inBrowser='object'==typeof document}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.assimilationRoot&&this.reassimilate(null,!0))}reassimilate(e=null,t=!1,n=!1,o=!1,s,r){var i;const a=this.assimilationRoot;if(!a)return void(this.settings.debugMode&&console.warn('__HostRender.reassimilate: Warning: No assimilation root assigned. ',this));const l=e?HostRender.createVirtualItemsFor(e):{};l.validator=s,l.suggester=r;const d=l.reused=new Set(e?[...this.externalElements,e]:this.externalElements),c=[];for(const[e,,o]of HostRender.getVirtualDomPairs(a,l,!1)){let s=e.domNode;!o||e.domNode&&!n||(s=o),s&&d.add(s);const r={treeNode:e};let i=t;if(s!==e.domNode&&(i=!0,e.domNode?s&&(r.swap=s):r.create=!0),!r.create&&s){const[t,n]=HostRender.findInsertionNodes(e);s.parentNode===t&&s.nextSibling===n||(r.move=!0),'content'===e.def.MIX_DOM_DEF?r.content=!0:(i&&(e.domProps=readDOMProps(s)),r.update=!0)}(r.create||r.swap||r.move||r.update||r.content)&&c.push(r)}if(o&&e){let t,n=e===a.domNode?rootDOMTreeNodes(a.children[0],!0).map((e=>e.domNode)).filter((e=>e)):[...e.childNodes],o=0;for(;t=n[o];)o++,d.has(t)?t.childNodes[0]&&(n=[...t.childNodes,...n.slice(o)],o=0):null===(i=t.parentNode)||void 0===i||i.removeChild(t)}if(this.settings.disableRendering||(this.paused=!1),c[0]&&this.applyToDOM(c),this.pausedPending){const e=this.pausedPending.filter((e=>e.treeNode.domNode&&!d.has(e.treeNode.domNode)));delete this.pausedPending,e[0]&&this.applyToDOM(e)}}applyToDOM(e){var t;const n=this.sourceRemount;if(n&&this.assimilationRoot&&HostRender.onRemount(n,this.assimilationRoot),this.paused){const t=e.filter((e=>e.remove));return void(t[0]&&(this.pausedPending=(this.pausedPending||[]).concat(t)))}const o=this.settings;let s=null,r=null,i=null,a=null;for(const l of e){const e=l.treeNode,d=e.def.attachedSignals,c=e.def.attachedRefs;if(l.remove){if('dom'===e.type&&e.domNode){const t=e.domNode,n=t.parentNode;let o=!1;if((null==d?void 0:d.domWillUnmount)&&d.domWillUnmount(t)&&(o=!0),c)for(const n of c)n.signals.domWillUnmount&&askListeners(n.signals.domWillUnmount,[t],['no-false','last'])&&(o=!0),Ref.willDetachFrom(n,e);o?i?i.push(t):i=[t]:!n||r&&-1!==r.indexOf(n)||i&&i.some((e=>e.contains(t)))||n.removeChild(t);const s='element'===e.def.MIX_DOM_DEF;(s||'content'===e.def.MIX_DOM_DEF)&&this.externalElements.delete(t),s||(r||(r=[])).push(t),e.domNode=null,HostRender.updateDOMChainBy(e,null)}continue}let u=!1,h=0;if(l.refresh&&e.domNode&&e.domProps&&(e.domProps='read'===l.refresh?readDOMProps(e.domNode):{},u=!0),l.create)if(e.domNode)h=!n||e.domNode.nodeType!==Node.TEXT_NODE||!0!==n.readFromDOM&&'content'!==n.readFromDOM?2:3;else switch(e.type){case'dom':const t=this.createDOMNodeBy(e);t&&(e.domNode=t,h=1,n&&n.created&&n.created.add(t));break;case'portal':e.domNode=e.def.domPortal||null}if(h||l.move)if('host'===e.type){const t=e.def.host||null;t&&t.services.refreshRoot(!1,null,null),e.domNode=e.parent&&t&&t.getRootElement()||null,HostRender.updateDOMChainBy(e,e.domNode)}else e.domNode&&(h<2||!e.domNode.parentElement?(s||(s=[])).push(l):((e.def.attachedRefs||e.def.attachedSignals)&&(a||(a=[])).push([!0,l.treeNode,e.domNode.parentElement,e.domNode.nextSibling]),HostRender.updateDOMChainBy(e,e.domNode)));if(l.swap){const n=!0!==l.swap,s=e.domNode;let r=n?l.swap:('portal'===e.type?e.def.domPortal:e.def.domElement)||null;if(s!==r){if(!n&&'dom'===e.type){const n=e,i=s&&s.parentNode;if(r&&(r=this.getApprovedNode(r,n),r)){let[t,n]=i?[i,s]:HostRender.findInsertionNodes(e);t&&t.insertBefore(r,n)}if(s){if(this.externalElements.delete(s),(null===(t=n.domProps)||void 0===t?void 0:t.listeners)&&s instanceof Element){const e=n.domProps.listeners;for(const t in e)e[t]&&s.removeEventListener(t,e[t])}i&&i.removeChild(s)}n.domProps&&(n.domProps=r&&'read'===o.renderDOMPropsOnSwap?readDOMProps(r):{},u=!0)}for(const t of e.children){const e=t.domNode;e&&(e.parentNode&&e.parentNode.removeChild(e),r&&r.appendChild(e))}e.domNode=r,HostRender.updateDOMChainBy(e,r)}}if((l.content||3===h)&&'dom'===e.type&&e.domNode){const t=e.def.domContent,n=e.domNode;let s=n;if('content'===e.def.MIX_DOM_DEF){if(e.def.domHTMLMode&&null!=t&&''!==t)s=HostRender.domNodeFrom(t.toString(),e.def.tag||o.renderHTMLDefTag,!0),s&&e.domProps&&(u=!0,e.domProps={});else{const e=null==t?'':(o.renderTextHandler?o.renderTextHandler(t):t).toString();n.nodeType!==Node.TEXT_NODE&&this.inBrowser?s=document.createTextNode(e):n.textContent=e}}else if(t instanceof Node){const e=t.parentNode;e&&e.removeChild(t)}else n.textContent='';if(s&&n!==s){const t=n.parentNode;t&&(e.domNode=s,t.insertBefore(s,n),t.removeChild(n)),HostRender.updateDOMChainBy(e,e.domNode)}if((null==d?void 0:d.domDidContent)&&d.domDidContent(e.domNode,null!=t?t:null),c)for(const n of c)n.signals.domDidContent&&callListeners(n.signals.domDidContent,[e.domNode,null!=t?t:null])}if((h||u||l.update)&&'dom'===e.type){const t=e.domNode instanceof Element?e.domNode:null,n=e.def.props||{},s=applyDOMProps(e.domNode instanceof Element?e.domNode:null,n,e.domProps||{},o.debugMode);if(e.domProps=n,s&&l.update&&t&&((null==d?void 0:d.domDidUpdate)&&d.domDidUpdate(t,s),c))for(const e of c)e.signals.domDidUpdate&&callListeners(e.signals.domDidUpdate,[t,s])}l.emptyMove&&HostRender.updateDOMChainBy(e,null,!0)}if(s){const e=[];let t=s.length;for(;t--;){const n=s[t],o=n.treeNode,r=o.domNode;if(r){const t=r.parentNode,s=r.nextSibling,[i,l]=r?HostRender.findInsertionNodes(o):[null,null];i===t&&l===s||(i&&e.push([r,i,l]),(o.def.attachedRefs||o.def.attachedSignals)&&(a||(a=[])).push([!n.move,n.treeNode,t,s]),t&&t.removeChild(r))}HostRender.updateDOMChainBy(o,r)}if(e[0])for(const t of e)t[1].insertBefore(t[0],t[2])}if(a){let e=a.length;for(;e--;){const[t,n,o,s]=a[e],{attachedSignals:r,attachedRefs:i}=n.def,l=n.domNode;if(r&&(t?r.domDidMount&&r.domDidMount(l):r.domDidMove&&r.domDidMove(l,o,s)),i)for(const e of i)t?(Ref.didAttachOn(e,n),e.signals.domDidMount&&callListeners(e.signals.domDidMount,[l])):e.signals.domDidMove&&callListeners(e.signals.domDidMove,[l,o,s])}}}getApprovedNode(e,t){let n=e;const o=null!=t.def.domCloneMode?t.def.domCloneMode:this.settings.duplicateDOMNodeBehaviour;return('always'===o||this.externalElements.has(e))&&(n=this.settings.duplicateDOMNodeHandler?this.settings.duplicateDOMNodeHandler(e,t):o?e.cloneNode('deep'===o||'always'===o):null),n&&this.externalElements.add(n),n}createDOMNodeBy(e){var t;const n=e.def.tag;if('string'!=typeof n)return null;if('_'===n)return e.def.domElement&&this.getApprovedNode(e.def.domElement,e)||null;const o=e.def.domContent;if(o instanceof Node)return this.getApprovedNode(o,e);const s=this.settings;if(e.def.domHTMLMode&&null!=o&&''!==o)return HostRender.domNodeFrom(o.toString(),n||s.renderHTMLDefTag,!0);if(n)return this.inBrowser?createDOMElement(n,null===(t=e.parent)||void 0===t?void 0:t.domNode,s.renderSVGNamespaceURI):null;let r=null,i='',a='';if(null!=o){a=(s.renderTextHandler?s.renderTextHandler(o):o).toString();const e=s.renderTextTag;if(e)if('string'==typeof e)i=e;else if('function'==typeof e){const t=e(o);t instanceof Node&&(r=t)}}if(!r){if(!this.inBrowser)return null;r=i?document.createElement(i):document.createTextNode(a)}return i&&a&&(r.textContent=a),r}static escapeHTML(e){return e.replace(/\&(?!(\w+;))/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}static findInsertionNodes(e){let t=null,n=e.parent;for(;n;){if(!(HostRender.PASSING_TYPES[n.type]||'root'===n.type&&n.parent)){t=n.domNode;break}n=n.parent}if(!t)return[null,null];let o=null,s=e;for(;s&&(n=s.parent,n);){let e,r=n.children.indexOf(s)+1;for(;e=n.children[r];){if(e.domNode&&'portal'!==e.type){o=e.domNode;break}r++}if(o||n.domNode===t)break;s=n}return[t,o]}static updateDOMChainBy(e,t,n=!1){let o=e,s=n?e:e.parent,r=t;for(;s&&(HostRender.PASSING_TYPES[s.type]||s===o);){if(s.children[0]!==o&&s!==o){let e=!1,t=s.children.indexOf(o)-1;for(;t>=0;){if(s.children[t].domNode){e=!0;break}t--}if(e)break}if(!r){let e,t=s.children.indexOf(o)+1;for(;e=s.children[t];){if(e.domNode&&'portal'!==e.type){r=e.domNode;break}t++}if(r&&s.domNode===r)break}s.domNode=r,o=s,s=s.parent}}static domNodeFrom(e,t='div',n=!1){const o=t instanceof Element?t:'object'==typeof document?document.createElement(t):null;return o?(o.innerHTML=e,n||o.children[1]?o:o.children[0]):null}static readDOMString(e,n=!1,o=-1,s=t){const r=e.def;if(!r)return'';let i=r.tag,a='';if('string'!=typeof i){if(e.children)for(const t of e.children)a+=HostRender.readDOMString(t,n,o,s);return a}let l=null;if(i)'_'===i&&(i='',l=r.domElement||null);else{const e=r.domContent;e&&(e instanceof Node?l=e:a+=e.toString())}if(!i&&!l)return a;const d=o>=0?'\n'+'\t'.repeat(o):'',c=o>=0?o+1:o,u=(null!=r.domContent?r.domContent instanceof Node?readDOMString('',null,null,r.domContent):n?HostRender.escapeHTML(r.domContent.toString()):r.domContent.toString():'')+(e.children?e.children.reduce(((e,t)=>e+HostRender.readDOMString(t,n,c,s)),''):'');return a+=d+readDOMString(i,e.domProps,u+(d&&e.children.some((e=>'dom'!==e.type||e.def.tag))?d:'')||s&&!s.includes(i),l||((null==r?void 0:r.domContent)instanceof Node?r.domContent:null)),a}static onRemount(e,t){let{reused:n,readFromDOM:o}=e;n||(n=e.reused=new Set),t.domNode&&n.add(t.domNode);for(const[s,r,i]of HostRender.getVirtualDomPairs(t,e,!0)){if(!0!==o&&'attributes'!==o||(s.domProps=readDOMProps(i)),s.domNode=i,n.add(i),s.def.domHTMLMode&&r)for(const e of HostRender.flattenVirtualItems(r))n.add(e.node);if(i.parentElement){let e=s;for(;e=e.parent;)if('dom'===e.type){i.parentElement!==e.domNode&&i.parentElement.removeChild(i);break}}}if(e.vRoot)for(const t of HostRender.flattenVirtualItems(e.vRoot)){if(n.has(t.node))continue;const o=t.node;e.unused&&e.unused.add(o),e.removeUnused&&o.parentElement&&o.parentElement.removeChild(o)}}static createVirtualItemsFor(e){var t,n;let o=null;const s={};if(o={tag:(null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())||'',node:e,parent:null},e.childNodes[0]){let t,r=[[[...e.childNodes],o]],i=0;for(;t=r[i];){i++;const[e,o]=t;o.children||(o.children=[]);let a=[];for(const t of e){const e={tag:(null===(n=t.tagName)||void 0===n?void 0:n.toLowerCase())||'',node:t,parent:o},r=t instanceof Element?t.getAttribute('_key'):null;null!=r&&(e.key=r,(s[e.tag]||(s[e.tag]=[])).push(e)),o.children.push(e),t.childNodes[0]&&a.push([[...t.childNodes],e])}a[0]&&(r=a.concat(r.slice(i)),i=0)}}return{vRoot:o,vKeyedByTags:s}}static flattenVirtualItems(e){let t,n=[e],o=0;for(;t=n[o++];)t.children&&t.children[0]&&(n=n.slice(0,o).concat(t.children.concat(n.slice(o))));return n}static getVirtualDomPairs(e,t,n){const{vRoot:o,vKeyedByTags:s,validator:r,suggester:i}=t,a=t.reused||new Set;let l,d=[],c=[[e,o||null]],u=0;for(;l=c[u++];){let[e,t]=l;if('dom'===e.type){const o=HostRender.getTreeNodeMatch(e,t,s,a,r,i);if(o){let n;o instanceof Node?(n=o,d.push([e,null,o])):(t=o,n=t.node),d.push([e,o===n?null:o,n]),a.add(n)}else n||d.push([e,t,null]),e.domNode&&a.add(e.domNode)}e.children[0]&&(c=e.children.map((e=>[e,t])).concat(c.slice(u)),u=0)}return d}static getTreeNodeMatch(e,t,n,o,s,r){const i=e.def.tag,a=e.def.key;if(r){const n=r(t,e,i,a);if(n){if((n instanceof Element?n.tagName.toLowerCase():'')===i&&(n instanceof Node?!(null==o?void 0:o.has(n)):!(null==o?void 0:o.has(n.node))&&HostRender.isVirtualItemOk(e,n,t,s)))return n}}const l=null!=a;if(t)for(const n of t.children?[t,...t.children]:[t])if(!n.used&&n.tag===i&&(l?n.key===a:null==n.key)&&!(null==o?void 0:o.has(n.node))&&(!s||s(n,e,i,a)))return n;if(n&&l){const r=n[i];if(r)for(const n of r)if(!n.used&&n.key===a&&!(null==o?void 0:o.has(n.node))&&HostRender.isVirtualItemOk(e,n,t,s))return n}return null}static isVirtualItemOk(e,t,n,o){if(t.tag!==e.def.tag)return!1;const s=e.def;if(n){let r=t;for(;r;){if(r===n)return!o||o(t,e,s.tag,s.key);r=r.parent}}else if(!o||o(t,e,s.tag,s.key))return!0;return!1}}function mergeChangesTo(e,...t){for(const n of t)n&&n[0][0]&&(e[0]=e[0].concat(n[0])),n&&n[1][0]&&(e[1]=e[1].concat(n[1]))}function sortBoundaries(e){const t=new Map;for(const n of e){let e=n.bId,o=n.parentBoundary;for(;o;)e=(o.bId||'')+'>'+e,o=o.parentBoundary;const s=t.get(e);if(s){let e=0;if(n.parentBoundary){const t=n.parentBoundary.innerBoundaries,o=t.indexOf(n);for(const n of s){if(o<t.indexOf(n))break;e++}}s.splice(e,0,n)}else t.set(e,[n])}const n=[];for(const e of t.keys()){let t=0,o=!1;for(const s of n){if(s.startsWith(e+'>'))break;if(e.startsWith(s+'>'))o=!0;else if(o)break;t++}n.splice(t,0,e)}let o=0;const s=[];for(const e of n)for(const n of t.get(e))s[o++]=n;return s}function updatedInterestedInClosure(e,t=!0){let n=[[],[]];for(const o of t&&e.size>1?sortBoundaries(e):e){if(!o._forceUpdate&&!o.component.lastState&&o.component.props===o._outerDef.props)continue;const e=o.host.services.updateBoundary(o);e&&mergeChangesTo(n,e)}return n}function collectInterestedInClosure(e,t){if(t){const e=new Set;if(t.closure.withContents)for(const n of t.closure.withContents)e.add(n);for(const n of t.constructor.WithContent.withContents)e.add(n);return e.size?e:null}if(!e.withContents&&!e.chainedClosures)return null;const n=e.withContents?new Set(e.withContents):new Set;if(e.chainedClosures)for(const t of e.chainedClosures){const e=collectInterestedInClosure(t);if(e)for(const t of e)n.add(t)}return n.size?n:null}function orderedIndex(e,t,n){return null!=n?null==e?t.findIndex((e=>e[n]<0)):e<0?t.findIndex((t=>null!=t[n]&&t[n]<0&&t[n]>e)):t.findIndex((t=>null==t[n]||t[n]<0||t[n]>e)):null==e?t.findIndex((e=>e<0)):e<0?t.findIndex((t=>null!=t&&t<0&&t>e)):t.findIndex((t=>null==t||t<0||t>e))}var u;function areEqual(e,t,n=-1){if(e===t)return!0;if(e&&n&&'object'==typeof e){if(!t||'object'!=typeof t)return!1;const o=e.constructor;if(o!==t.constructor)return!1;n--;let s=!1;switch(o){case Object:break;case Array:s=!0;break;case Set:if(s=!0,e.size!==t.size)return!1;e=[...e],t=[...t];break;case Map:if(e.size!==t.size)return!1;for(const[o,s]of e){if(!t.has(o))return!1;if(n?!areEqual(t.get(o),s,n):t.get(o)!==s)return!1}return!0;default:const o=e.toString();'[object NodeList]'!==o&&'[object HTMLCollection]'!==o||(s=!0)}if(s){const o=e.length;if(o!==t.length)return!1;for(let s=0;s<o;s++)if(n?!areEqual(e[s],t[s],n):e[s]!==t[s])return!1}else{for(const o in t){if(!e.hasOwnProperty(o))return!1;if(n?!areEqual(e[o],t[o],n):e[o]!==t[o])return!1}for(const n in e)if(!t.hasOwnProperty(n))return!1}return!0}return!1}function areEqualBy(e,t,n){var o;const s=!e||!t;for(const r in n){const i=n[r],a='number'==typeof i?i:null!==(o=u[i])&&void 0!==o?o:0;if(a<-1){if(-2===a)return!1}else{if(s)return!e&&!t;if(0===a){if(e[r]!==t[r])return!1}else if(!areEqual(e[r],t[r],a))return!1}}return!0}function createTrigger(e,t,n=1){const o='string'==typeof n?u[n]:n;let s;return(n,r=!1,i)=>{const a=t;if(o<-1){if(-2!==o)return!1}else if(!r&&areEqual(a,n,o))return!1;return void 0!==i&&(s&&s(a,n),s=void 0,e=i||void 0),t=n,e&&(s=e(n,a)||void 0),!1}}function createMemo(e,t=0){let n,o;const s='string'==typeof t?u[t]:t;return(...t)=>{if(o)if(s<-1){if(-2!==s)return n}else if(areEqual(o,t,s>=0?s+1:s))return n;return o=t,n=e(...t),n}}function createDataSource(e,t,n=0){let o,s;const r=(n='string'==typeof n?u[n]:n)>=0?n+1:n,f=(...n)=>{const i=e(...n);if(o)if(r<-1){if(-2!==r)return s}else if(areEqual(i,o,r))return s;return o=i,s=t(...o),s};return f.clear=()=>{o=s=void 0},f}HostRender.PASSING_TYPES={boundary:!0,pass:!0,host:!0,fragment:!0},function(e){e[e.never=-3]='never',e[e.always=-2]='always',e[e.deep=-1]='deep',e[e.changed=0]='changed',e[e.shallow=1]='shallow',e[e.double=2]='double'}(u||(u={}));var h=Object.freeze({__proto__:null,get CompareDepthEnum(){return u},areEqual,areEqualBy,cleanIndex:function cleanIndex(e,t){return t?'number'==typeof e?e<0?Math.max(0,e+t):Math.min(e,t-1):t-1:-1},createCachedSource:function createCachedSource(e,t,n,o=0){const s={},f=(...r)=>{const i=n(...r,s);return s[i]||(s[i]=createDataSource(e,t,o)),s[i](...r)};return f.clear=e=>{const t='function'==typeof e;for(const n of Object.keys(s))e&&!(t?e(n):e.includes(n))||delete s[n]},f.getCached=()=>s,f},createDataMemo:createMemo,createDataSource,createDataTrigger:createTrigger,createMemo,createTrigger,deepCopy:function deepCopy(e,t=-1){if(!e||!t||'object'!=typeof e)return e;t--;let n=null;switch(e.constructor){case Object:break;case Array:n=e;break;case Set:return new Set(t?[...e].map((e=>deepCopy(e,t))):e);case Map:return new Map(t?[...e].map((([e,n])=>[deepCopy(e,t),deepCopy(n,t)])):e);default:const o=e.toString();'[object NodeList]'!==o&&'[object HTMLCollection]'!==o||(n=[...e])}if(n)return t?n.map((e=>deepCopy(e,t))):[...n];if(!t)return Object.assign({},e);const o=new e.constructor;for(const n in e)o[n]=deepCopy(e[n],t);return o},numberRange:function numberRange(e,t,n,o){const s=n<0;let[r,i]=null==t?[0,e]:[e,t];const a=r<i;n=n?a!==s?n:-n:a?1:-1;const l=[];if(o)for(;a?r<=i:r>=i;)l.push(r),r+=n;else for(;a?r<i:r>i;)l.push(r),r+=n;return s&&l.reverse(),l},orderArray:function orderArray(e,t){const n=[],o=!Array.isArray(t);for(let s=0,r=e.length;s<r;s++){const r=o?e[s][t]:t[s],i=orderedIndex(r,n,0);-1===i?n.push([r,e[s]]):n.splice(i,0,[r,e[s]])}return n.map((e=>e[1]))},orderedIndex});const p={fragment:1,portal:2,pass:3,host:4};function assignTreeNodesFor(e,t,n,o,s){t.children[0]&&(t.children=[]);const r=e.length;if(!r)return[];const i=[];let a=0,l=null,d=t;if(n){if(!t.parent)return[];if(d=t.parent,l=t,a=d.children.indexOf(t),-1===a)return[]}for(let t=0;t<r;t++){const n=e[t];if(n.disabled){a--,i.push(null);continue}let r=null;n.treeNode?r=n.treeNode:'fragment'!==n.MIX_DOM_DEF&&(n.action='mounted'),l&&(r?d.children.splice(a,1):r=l,l=null);const c=n.MIX_DOM_DEF,u='content'===c||'element'===c?'dom':'fragment'===c?'':c;if(r){if(r.parent){const e=r.parent.children.indexOf(r);0===e&&r.parent!==d&&!0===HostRender.PASSING_TYPES[r.parent.type]&&s&&-1===s.indexOf(r.parent)&&s.push(r.parent),-1!==e&&r.parent.children.splice(e,1)}r.parent=d,r.sourceBoundary=o||null,r.type=u}else r={type:u,parent:d,children:[],sourceBoundary:o||null,domNode:null},'dom'===r.type&&(r.domProps={});'fragment'!==n.MIX_DOM_DEF&&(r.def=n,n.treeNode=r),d.children.splice(a+t,0,r),i.push(r)}return i}function findAppliedDefsFor(e,t,n,o,s,r,i){var a,l,d,c,u,h;let m=t.childDefs.length;if(!m)return[];const g=r||!t.isArray;if(!r&&t.isArray!=(e&&e.isArray))return t.childDefs.map((e=>newAppliedDef(e,s&&s.closure||null)));const y=e&&e.childDefs||null,D=[];for(let r=0;r<m;r++){const m=t.childDefs[r],C=null!=m.key,v=m.MIX_DOM_DEF,b=m.getRemote||p[v]||m.tag;let M=!1,x=null;if(y)for(const e of y)if((C?e.key===m.key:null==e.key)&&b===(e.getRemote||p[e.MIX_DOM_DEF]||e.tag)&&o.has(e)&&('boundary'!==v||!(null===(d=null===(l=null===(a=e.treeNode)||void 0===a?void 0:a.boundary)||void 0===l?void 0:l.component)||void 0===d?void 0:d.constantProps)||areEqualBy(m.props,e.props,e.treeNode.boundary.component.constantProps))){x=e,o.delete(e),x.updateId&&x.updateId!==i&&delete x.updateId;break}if(!x&&C&&g){const e=n&&n.get(b);if(e)for(const t of e)if(t.key===m.key&&o.has(t)&&('boundary'!==v||!(null===(h=null===(u=null===(c=t.treeNode)||void 0===c?void 0:c.boundary)||void 0===u?void 0:u.component)||void 0===h?void 0:h.constantProps)||areEqualBy(m.props,t.props,t.treeNode.boundary.component.constantProps))){x=t,o.delete(t),M=!0;for(const e of allDefsIn(x))e.updateId=i;break}}x?x.action=M||!e||e.childDefs[r]!==x?'moved':'updated':x=newAppliedDef(m,s&&s.closure||null),D.push(x)}return D}function buildDefMaps(e,t=!1,n=new Set,o){const s=new Map;let r,i=t?e.childDefs.slice():[e],a=0;for(;r=i[a];){a++,n.add(r);const e=r.getRemote||p[r.MIX_DOM_DEF]||r.tag,t=s.get(e);if(t?t.push(r):s.set(e,[r]),r.scopeType)if('spread-pass'===r.scopeType)o&&o.push(r);else{const e=[];r.scopeMap=buildDefMaps(r,!0,n,e)[0],e[0]&&(i=e[0].childDefs.concat(i.slice(a)),a=0)}else r.childDefs[0]&&(i=r.childDefs.concat(i.slice(a)),a=0)}return[s,n]}class BaseBoundary{constructor(e,t,n){this.host=e,this.treeNode=n,this._outerDef=t,this._innerDef=null,this.isMounted=!1,this.sourceBoundary=null,this.parentBoundary=null,this.innerBoundaries=[]}}class ContentBoundary extends BaseBoundary{constructor(e,t,n,o){super(o.host,e,n),this.sourceBoundary=o,this.targetDef=t,this._innerDef=newAppliedDef(t,o.closure)}updateEnvelope(e,t){this.targetDef=e,t&&(this._innerDef.childDefs=t.childDefs)}}class ContentClosure{constructor(e,t){this.thruBoundary=e||null,this.sourceBoundary=t||null,this.envelope=null,this.truePassDef=null,this.groundedDefs=new Map,this.pendingDefs=new Set}hasContent(){var e;return!(!(null===(e=this.envelope)||void 0===e?void 0:e.applied)||!hasContentInDefs(this.envelope.applied.childDefs,!1))}readContent(e=!1){if(!this.envelope)return null;const t=this.envelope.applied,n=t.childDefs;if('fragment'===t.MIX_DOM_DEF&&(!n.length||n[0].disabled&&1===n.length))return null;const o=this.envelope.target.childDefs;return e?o.slice():o}}class ComponentContextAPI extends ContextAPI{afterRefresh(e=!1,t,n){return e?(this.host.triggerRefresh(t,n),this.awaitDelay()):this.host.afterRefresh(!1,t,n)}awaitDelay(){return this.host.afterRefresh(!0)}}function mixinComponent(e){var t;return t=class Component extends(mixinSignalMan(e)){constructor(e,t,...n){super(...n),this.props=e,t&&(this.boundary=t,t.component=this)}initContextAPI(){if(this.contextAPI)return;this.contextAPI=new ComponentContextAPI;const e=this.contextAPI.host=this.boundary.host;e.contextComponents.add(this),this.contextAPI.setContexts(e.contextAPI.contexts,!1,!0);const t=this.boundary._outerDef.attachedContexts;if(t)for(const e in t)this.contextAPI.setContext(e,t[e],!1)}isMounted(){return!0===this.boundary.isMounted}getLastState(e=!0){return this.lastState||e&&this.state||null}getHost(){return this.boundary.host}queryElement(e,t=!1,n=!1){return domElementByQuery(this.boundary.treeNode,e,t,n)}queryElements(e,t=0,n=!1,o=!1){return domElementsByQuery(this.boundary.treeNode,e,t,n,o)}findElements(e=0,t=!1,n=!1,o){return treeNodesWithin(this.boundary.treeNode,new Set(['dom']),e,t,n,o).map((e=>e.domNode))}findComponents(e=0,t=!1,n=!1,o){return treeNodesWithin(this.boundary.treeNode,new Set(['boundary']),e,t,n,o).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,t=0,n=!1,o=!1,s){const r=e?e.constructor===Set?e:e.constructor===Array?new Set(e):new Set(Object.keys(e)):void 0;return treeNodesWithin(this.boundary.treeNode,r,t,n,o,s)}setTimer(e,t,n){return null==e&&(e={}),this.timers?this.timers.has(e)&&this.clearTimers(e):this.timers=new Map,this.timers.set(e,setTimeout((()=>{this.clearTimers(e),t.call(this)}),n)),e}hasTimer(e){return!!this.timers&&this.timers.has(e)}clearTimers(...e){if(this.timers)if(e.length)for(const t of e){const e=this.timers.get(t);null!=e&&(clearTimeout(e),this.timers.delete(t))}else this.timers.forEach((e=>clearTimeout(e))),this.timers.clear()}setUpdateModes(e,t=!0){t&&this.updateModes||(this.updateModes={});for(const t in e)this.updateModes[t]=e[t]}setConstantProps(e,t=!0,n=null){var o,s;t&&this.constantProps||(this.constantProps={});let r=!1;if(e)if(Array.isArray(e))for(const t of e)this.constantProps[t]=null===(o=(r=!0)&&n)||void 0===o||o;else for(const t in e)this.constantProps[t]=null!==(s=(r=!0)&&n)&&void 0!==s?s:e[t];r||t||delete this.constantProps}setState(e,t=!0,n,o,s){this.boundary.updateBy({state:t?Object.assign(Object.assign({},this.state),e):Object.assign({},e)},n,o,s)}setInState(e,t,n,o,s){this.boundary.updateBy({state:Object.assign(Object.assign({},this.state),{[e]:t})},n,o,s)}triggerUpdate(e,t,n){this.boundary.host.services.absorbUpdates(this.boundary,{force:e||!1},!0,t,n)}addWired(e){this.wired?this.wired.add(e):this.wired=new Set([e])}removeWired(e){var t;null===(t=this.wired)||void 0===t||t.delete(e)}afterRefresh(e=!1,t,n){return e?(this.boundary.host.triggerRefresh(t,n),this.awaitDelay()):this.boundary.host.afterRefresh(!1,t,n)}awaitDelay(){return this.boundary.host.afterRefresh(!0)}render(e,t){return null}},t.MIX_DOM_CLASS='Component',t}class Component extends(mixinComponent(Object)){constructor(e,t){super(e,t)}}function createComponent(e,t,n){const o=t&&'object'==typeof t?t:void 0,s=(o?n:t)||e.name||'[createComponent]',r=e.length>1?{[s]:(t,n,o)=>e(n,o)}[s]:{[s]:(t,n)=>e(n)}[s];if(o)for(const e in o)r[e]=o[e];return r}function createComponentCtx(e,t,n){const o=t&&'object'==typeof t?t:void 0,s=(o?n:t)||e.name||'[createComponentCtx]',r={[s]:(t,n,o)=>e(n,o)}[s];if(o)for(const e in o)r[e]=o[e];return r}class SourceBoundary extends BaseBoundary{constructor(e,t,n,o){super(e,t,n),this.bId=e.services.createBoundaryId(),this.sourceBoundary=o||null,this.closure=new ContentClosure(this,o)}reattach(){this.component=null;const e=this._outerDef.props||{};let t=this._outerDef.tag;if('function'==typeof t){const n=t.api,o=t.MIX_DOM_CLASS?null:this._outerDef.tag,s=o&&o.length>=3||!1,r=this.component=new(o?SourceBoundary.getComponentFuncClass(o):t)(e,this);if(this.component=r,s&&r.initContextAPI(),o&&(r.render=s?e=>o.call(r,e,r,r.contextAPI):e=>o.call(r,e,r)),r.boundary||(r.boundary=this),n){r.constructor.api=n,n.components.add(r);for(const e in n.signals)for(const t of n.signals[e]){const[n,o,s]=t;r.listenTo(e,((...e)=>o?n(r,...e,...o):n(r,...e)),null,s,n)}}'Remote'===t.MIX_DOM_CLASS&&(this.closure.remote=r,t.addSource(r)),r.signals.preMount&&callListeners(r.signals.preMount)}else this.component=new Component(e,this)}update(e,t,n){this.host.services.absorbUpdates(this,{force:this.isMounted?e||!1:'all'},!0,t,n)}updateBy(e,t,n,o){this.host.services.absorbUpdates(this,Object.assign(Object.assign({},e),{force:this.isMounted?t||!1:'all'}),!0,n,o)}render(e=0){const t=!1===this.isMounted&&!this._renderState;e||(this._renderState='active');const n=this.component,o=n.render(n.props||{},n.state),s='function'==typeof o;if(s&&(n.render=o),t&&n.contextAPI&&n.contextAPI.callDataBy(),s)return this.render(e);if('re-updated'===this._renderState){const t=this.host.settings;if(t.maxReRenders<0||e<t.maxReRenders)return e++,this._renderState='active',this.render(e);t.debugMode&&console.warn('__SourceBoundary.render: Warning: The component tried to render for over '+(e+1).toString()+' times.',this._outerDef.tag.MIX_DOM_CLASS?n.constructor:this._outerDef.tag,n)}return delete this._renderState,o}static getComponentFuncClass(e){let t=!1;for(const n in e){t=!0;break}if(!t)return Component;const n={[e.name]:class extends Component{}}[e.name];for(const t in e)n[t]=e[t];return n}}function runPassUpdate(e,t=!1){const[n,o,s]=function assignTreeNodesForPass(e){const t=e._innerDef,n=e.sourceBoundary,o=[],s=[],r=[];let i,a=[[e.targetDef,t,e.treeNode,!1]],l=0;for(;i=a[l];){l++;const[e,t,d,c]=i;if(c&&!e.childDefs[0]&&d&&!d.type&&d.parent){const e=d.parent.children,t=e.indexOf(d);-1!==t&&e.splice(t,1),d.sourceBoundary=null}else{if(t.childDefs[0]){const r=d&&'boundary'!==e.MIX_DOM_DEF&&('element'!==e.MIX_DOM_DEF||e.domElement)?assignTreeNodesFor(t.childDefs,d,c,n,s):[];let i=0;const u=[];for(const n of t.childDefs){const t=r[i]||null;!t&&n.treeNode&&(o.push(n.treeNode),n.treeNode.sourceBoundary=null),u.push([e.childDefs[i],n,t,'fragment'===n.MIX_DOM_DEF]),i++}a=u.concat(a.slice(l)),l=0}d&&!t.disabled&&r.push([e,t,d])}}return[r,o,s]}(e);let[r,i]=applyDefPairs(e,n,t);if(o[0]){const e=new Set;for(const t of o)t.sourceBoundary||(t.def&&e.add(t.def),t.parent=null);if(e.size){const t=cleanUpDefs(e);r=t[0].concat(r),i=t[1].concat(i)}}return s[0]&&(r=s.map((e=>({treeNode:e,emptyMove:!0}))).concat(r)),e.isMounted=!0,[r,i]}function runBoundaryUpdate(e,t=!1){let n,o,s=null,r=e._innerDef;e.bId?(s=newDefFrom(e.render()),s&&!r&&(r=newAppliedDef(s,e.closure))):s=e.targetDef;const[i,a]=r?buildDefMaps(r):[new Map,new Set],l=[];if(s){const d=[],c=function pairDefs(e,t,n,o,s,r,i){const a=e.host.settings,l=a.noRenderValuesMode,d=a.wideKeysInArrays,c=[],u=e.bId?e:e.sourceBoundary;let h,p=[[{childDefs:[t]},{childDefs:[n]},e.treeNode,!1,null]],m=0;for(;h=p[m];){m++;const[t,n,a,g]=h,y='spread-pass'===n.scopeType?void 0:n.scopeMap||h[5];if(t.childDefs[0]){const c=findAppliedDefsFor(n,t,y||o,s,u,d,e.host.services._whileUpdating);n.childDefs=c;for(let e,o=0;e=t.childDefs[o];o++)if('content'===e.MIX_DOM_DEF){const t=n.childDefs[o];l&&(!0===l?!e.domContent:-1!==l.indexOf(e.domContent))?t.disabled=!0:delete t.disabled}const D='boundary'===t.MIX_DOM_DEF,C=h[4]||D&&n;D&&delete n.hasPassWithin;const v=!a||D||'element'===t.MIX_DOM_DEF&&!t.domElement?[]:assignTreeNodesFor(c,a,g,u,i),b=[];for(let e,n=0;e=t.childDefs[n];n++){const t=v[n]||null,o=c[n];!t&&o.treeNode&&(o.treeNode.sourceBoundary=null,r&&r.push(o)),C&&'pass'===e.MIX_DOM_DEF&&(C.hasPassWithin=!0);const s=[e,o,t,'fragment'===e.MIX_DOM_DEF,C||'boundary'===e.MIX_DOM_DEF&&o||null];b.push(s),y&&(s[5]=y)}p=b.concat(p.slice(m)),m=0}else n.childDefs=[];a&&t.MIX_DOM_DEF&&n.MIX_DOM_DEF&&c.push([t,n,a])}return c}(e,s,r,i,a,d,l);if(e._innerDef=c[0][1],[n,o]=applyDefPairs(e,c,t),d[0])for(const e of d){const t=e.treeNode;t&&null===t.sourceBoundary&&a.add(e)}}else n=[],o=[],!r&&e.isMounted||l.push(e.treeNode),e.innerBoundaries=[],e.treeNode.children=[],e._innerDef=null;if(a.size){const e=cleanUpDefs(a);n=e[0].concat(n),o=e[1].concat(o)}return l[0]&&(n=l.map((e=>({treeNode:e,emptyMove:!0}))).concat(n)),e.isMounted||(e.isMounted=!0),[n,o]}function applyDefPairs(e,t,n=!1){var o,s;const r=e.bId?e:e.sourceBoundary,i=[],l=e.host.settings.preCompareDOMProps;e.innerBoundaries=[];let d=[[],[]];for(const c of t){const[t,u,h]=c,p='mounted'===u.action;if(!p&&'moved'===u.action)switch(u.MIX_DOM_DEF){case'fragment':for(const e of rootDOMTreeNodes(h,!0,!0))-1===i.indexOf(e)&&(i.push(e),d[0].push({treeNode:e,move:!0}));break;case'host':u.host&&u.host.groundedTree.parent===h&&d[0].push({treeNode:h,move:!0})}if('fragment'===u.MIX_DOM_DEF)continue;if('pass'===h.type){if('pass'!==u.MIX_DOM_DEF)continue;let t=a.key;if(u.getRemote){const n=u.getRemote();t=null===(o=n.Content)||void 0===o?void 0:o.key,mergeChangesTo(d,groundClosureContent(n.closure,u,e,h,u.key!==t?u.key:null))}else u.contentPass&&mergeChangesTo(d,groundClosureContent(u.contentPass,u,e,h,u.key!==t?u.key:null));h.boundary&&e.innerBoundaries.push(h.boundary);continue}const m=u.props;let g=!1;t.props&&(h.boundary&&(h.boundary._outerDef.props=t.props),u.props=t.props||{});let y=!1;switch(u.MIX_DOM_DEF){case'content':y=!0;const n=t.domHTMLMode;g=u.domContent!==t.domContent||n!==t.domHTMLMode,g&&(u.domContent=t.domContent,void 0!==n?u.domHTMLMode=n:delete u.domHTMLMode);break;case'element':y=!0,u.domElement!==t.domElement&&(p||d[0].push({treeNode:h,swap:!0}),u.domElement=t.domElement||null),u.domCloneMode=null!=t.domCloneMode?t.domCloneMode:null;break;case'dom':y=!0;break;case'portal':u.domPortal!==t.domPortal&&(d[0].push({treeNode:h,[p?'create':'swap']:!0}),u.domPortal=t.domPortal||null);break;case'boundary':if(p){t.attachedContexts&&(u.attachedContexts=t.attachedContexts);const n=new SourceBoundary(e.host,u,h,r);n.parentBoundary=e,h.boundary=n}break;case'host':if(u.host){const e=u.host;let t=e;if('mounted'===u.action){if(e.groundedTree.parent){const n=t.settings.duplicatableHost;if('function'==typeof n){const e=n(u.host,h);if(!e)break;if('object'==typeof e){if(e.groundedTree.parent)break;t=e}}else if(!n)break;const o=e.shadowAPI;t===e?t=new e.constructor(e.services.getRootDef(!0),null,e.settings,null,o):t.shadowAPI!==e.shadowAPI&&(t.shadowAPI.hosts.delete(t),t.shadowAPI=e.shadowAPI);for(const e in o.contexts){const n=o.contexts[e];n&&t.contextAPI.setContext(e,n,!1)}u.host=t}e.shadowAPI.hosts.add(t)}t.groundedTree.parent=h,h.children=[t.groundedTree],d[0].push({treeNode:h,move:!0});break}}if(y){if(p)d[0].push({treeNode:h,create:!0});else{const e='moved'===u.action&&-1===i.indexOf(h),n=!!u.tag&&(!l||'if-needed'===l&&(g||e)||!equalDOMProps(m||{},t.props||{}));if(n||g||e){const t={treeNode:h};n&&(t.update=!0),g&&(t.content=!0),e&&(t.move=!0,i.push(h)),d[0].push(t)}}u.attachedSignals!==t.attachedSignals&&(t.attachedSignals?u.attachedSignals=t.attachedSignals:delete u.attachedSignals)}if(h.boundary){const o=h.boundary;if(e.innerBoundaries.push(o),p){if(u.tag&&u.tag._WithContent){const e=u.tag._WithContent,t=e.getRemote?e.getRemote().closure:r.closure;(t.withContents||(t.withContents=new Set)).add(o)}o.reattach()}const a=o.component;if(u.attachedSignals!==t.attachedSignals){const e=getDictionaryDiffs(u.attachedSignals||{},t.attachedSignals||{});if(e)for(const t in e)e[t]?a.listenTo(t,e[t]):a.unlistenTo(t,u.attachedSignals[t]);u.attachedSignals=t.attachedSignals}if(u.attachedContexts!==t.attachedContexts){if(a.contextAPI){const e=getDictionaryDiffs(u.attachedSignals||{},t.attachedSignals||{});if(e){for(const t in e)e[t]?a.contextAPI.setContext(t,e[t]):a.contextAPI.setContext(t,null);a.contextAPI.callDataBy(p||Object.keys(e))}}u.attachedContexts=t.attachedContexts}let l=null;const c=o.closure.envelope;t.childDefs[0]&&(l=c?{applied:Object.assign(Object.assign({},c.applied),{childDefs:u.childDefs,action:u.action}),target:Object.assign(Object.assign({},c.target),{childDefs:t.childDefs})}:{applied:{tag:null,MIX_DOM_DEF:'fragment',childDefs:u.childDefs,action:'mounted'},target:{tag:null,MIX_DOM_DEF:'fragment',childDefs:t.childDefs}});const m=c||l?o.closure:null;let g=null;if(m){g=preRefreshClosure(m,l);const e=r.closure;u.hasPassWithin?(e.chainedClosures||(e.chainedClosures=new Set)).add(m):null===(s=e.chainedClosures)||void 0===s||s.delete(m)}mergeChangesTo(d,e.host.services.updateBoundary(o,n,i,g)),m&&mergeChangesTo(d,applyClosureRefresh(m,n))}if(u.attachedRefs||t.attachedRefs){const e=u.attachedRefs,n=t.attachedRefs;if(e)for(const t of e)n&&n.includes(t)||Ref.willDetachFrom(t,h);if(n)for(const t of n)e&&e.includes(t)||Ref.didAttachOn(t,h);u.attachedRefs=n}}return d}function cleanUpDefs(e,t=!0,n=!0){var o;let s=[[],[]];for(const r of e){const e=r.treeNode;if(e){switch(r.MIX_DOM_DEF){case'dom':case'element':case'content':n&&s[0].push({treeNode:e,remove:!0});break;case'boundary':e.boundary&&mergeChangesTo(s,destroyBoundary(e.boundary,!1,n));break;case'pass':(r.contentPass||r.getRemote)&&mergeChangesTo(s,ungroundClosureContent(r.contentPass||r.getRemote().closure,r));case'host':{const t=r.host;if(t&&t.groundedTree.parent===e){t.groundedTree.parent=null,e.children=[],s[0].push({treeNode:e,move:!0}),t.shadowAPI.hosts.delete(t);const n=t.contextAPI.getContexts(null,!0,!0);for(const e in n)n[e].contextAPIs.delete(t.contextAPI)}}default:if(r.attachedRefs&&r.MIX_DOM_DEF)for(const t of r.attachedRefs)Ref.willDetachFrom(t,e)}t&&('pass'===(null===(o=e.parent)||void 0===o?void 0:o.type)&&e.parent.def.getRemote&&s[0].push({emptyMove:!0,treeNode:e.parent}),e.parent=null,e.sourceBoundary=null,delete r.treeNode)}}return s}function destroyBoundary(e,t=!0,n=!0){var o,s,r;let i=[[],[]];if(null===e.isMounted)return i;const a=e.bId?e:null;if(a){const e=a.component,t=e.constructor;e.signals.willUnmount&&callListeners(e.signals.willUnmount);const n=a._outerDef;if(n.attachedRefs)for(const e of n.attachedRefs)Ref.willDetachFrom(e,a.treeNode);if(null===(s=null===(o=a.sourceBoundary)||void 0===o?void 0:o.closure.chainedClosures)||void 0===s||s.delete(a.closure),e.contextAPI){const t=e.contextAPI,n=t.getContexts(null,!0,!0);for(const e in n)n[e].contextAPIs.delete(t);t.contexts={},a.host.contextComponents.delete(e)}if(t.api&&(t.api.components.delete(e),t.api.signals&&(t.api.signals={})),'Remote'===t.MIX_DOM_CLASS&&mergeChangesTo(i,t.removeSource(e)),n.tag._WithContent){const e=n.tag._WithContent,t=e.getRemote?e.getRemote().closure:null===(r=a.sourceBoundary)||void 0===r?void 0:r.closure;(null==t?void 0:t.withContents)&&(t.withContents.delete(a),t.withContents.size||delete t.withContents)}e.signals&&(e.signals={}),e.timers&&e.clearTimers()}return n&&(i[0]=i[0].concat(rootDOMTreeNodes(e.treeNode,!0).map((e=>({treeNode:e,remove:!0}))))),e._innerDef&&mergeChangesTo(i,cleanUpDefs(allDefsIn(e._innerDef,!0),t,!1)),a&&a.host.services.cancelUpdates(a),e.isMounted=null,i}function groundClosureContent(e,t,n,o,s){return e.groundedDefs.get(t)?'moved'===t.action&&o.boundary?[rootDOMTreeNodes(o.boundary.treeNode,!0,!0).map((e=>({treeNode:e,move:!0}))),[]]:[[],[]]:(e.groundedDefs.set(t,[n,o,s]),applyContentDefs(e,[t]))}function ungroundClosureContent(e,t){const n=e.groundedDefs.get(t);if(!n)return[[],[]];e.groundedDefs.delete(t),e.pendingDefs.delete(t),e.truePassDef===t&&(e.truePassDef=null);const o=n[1].boundary;return o?destroyBoundary(o):[[],[]]}function preRefreshClosure(e,t,n){if(e.remote)return e.envelope=t,preRefreshClosure(e.remote.closure,t,e.remote);if(!e.envelope&&!t)return null;const o=collectInterestedInClosure(e,n);if(o)for(const e of o)e._forceUpdate=e._forceUpdate||!0;return e.envelope=t,e.pendingDefs=new Set(e.groundedDefs.keys()),o}function applyClosureRefresh(e,t=!1){if(e.remote)return applyClosureRefresh(e.remote.closure,t);let n=[],o=[];return e.pendingDefs.size&&([n,o]=applyContentDefs(e,e.pendingDefs,t)),[n,o]}function applyContentDefs(e,t,n=!1){let o=[],s=[];for(const r of t){e.pendingDefs.delete(r);const t=e.groundedDefs.get(r);if(void 0===t)continue;let[i,a,l]=t,d=a.boundary;if(e.envelope&&e.sourceBoundary){let t=!0;const c=e.envelope;d?(t=e.truePassDef===r,d.updateEnvelope(c.target,t?c.applied:null)):(d=new ContentBoundary(r,c.target,a,e.sourceBoundary),t=null==l&&(!e.truePassDef||e.truePassDef===r),t&&(d._innerDef.childDefs=c.applied.childDefs,e.truePassDef=r),d.parentBoundary=i,a.boundary=d);const[u,h]=t?runPassUpdate(d,n):runBoundaryUpdate(d,n);o=o.concat(u),s=s.concat(h)}else if(d){const e=destroyBoundary(d,!1);o=o.concat(e[0]),s=s.concat(e[1]),a.boundary=null}}return[o,s]}class HostServices{constructor(e){this.host=e,this.bIdCount=0,this.renderer=new HostRender(e.settings,e.groundedTree),this.updateCycle=new RefreshCycle({initPending:()=>({updates:new Set})}),this.renderCycle=new RefreshCycle({initPending:()=>({rCalls:[],rInfos:[]}),autoRenewPromise:!0}),this.constructor.initializeCyclesFor(this)}createBoundaryId(){return'h-'+this.host.constructor.idCount.toString()+':b-'+(this.bIdCount++).toString()}clearTimers(e=!1){e||(this.updateCycle.resolve(),this.renderCycle.resolve()),this.updateCycle.reject(),this.renderCycle.reject()}createRoot(e){return this.rootDef=newDefFrom(e),{HostRoot:(e,t)=>()=>this._rootDisabled?null:this.rootDef}.HostRoot}updateRoot(e,t,n){this.rootDef=newDefFrom(e),this.host.rootBoundary.update(!0,t,n)}refreshRoot(e=!1,t,n){const o=!this._rootDisabled,s=this.host,r=!(s.settings.onlyRunInContainer&&!s.groundedTree.domNode&&!s.groundedTree.parent);if(r?delete this._rootDisabled:this._rootDisabled=!0,!e&&r&&o){if(r&&o){const e=s.rootBoundary?rootDOMTreeNodes(s.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0}))):[];this.absorbChanges(e,null,n)}}else s.rootBoundary.update(!0,t,n)}clearRoot(e=!1){this.clearTimers(e),this.rootDef=null}getRootDef(e){return this.rootDef&&(e?Object.assign({},this.rootDef):this.rootDef)}hasPending(e=!0,t=!0){return!!(e&&this.updateCycle.state||t&&this.renderCycle.state)}addRefreshCall(e,t=!1){t?this.renderCycle.promise.then(e):this.updateCycle.promise.then(e)}cancelUpdates(e){var t;null===(t=this.updateCycle.pending.updates)||void 0===t||t.delete(e)}absorbUpdates(e,t,n=!0,o,s){if(null!==e.isMounted){if(t.force&&(e._forceUpdate='all'===e._forceUpdate?'all':t.force),t.props&&(e._outerDef.props=t.props),t.state){const n=e.component;n.lastState||(n.lastState=Object.assign({},n.state)),n.state=t.state}e._renderState?e._renderState='re-updated':(this.updateCycle.pending.updates.add(e),n&&this.triggerRefresh(o,s))}}triggerRefresh(e,t){this.updateRefreshTimes(e,t),this.updateCycle.trigger(this.host.settings.updateTimeout)}updateRefreshTimes(e,t){void 0!==e&&this.updateCycle.extend(e),void 0!==t&&this.renderCycle.extend(t)}updateBoundary(e,t=!1,n,o){let s=!!t,r='all'===t,i=[],a=[];const l=e.component,d=!e.isMounted;if(d){if(null===e.isMounted)return null;a.push([e,'mounted']),s=!0}const c=e._outerDef.props!==l.props?l.props||{}:void 0;c&&(l.props=e._outerDef.props);const u=l.constructor.api;if(u&&(d||c)&&(d&&u.onBuildProps&&!u.builtProps&&(u.builtProps=u.onBuildProps(null)),u.getMixedProps&&(d||l.lastState||(l.lastState=Object.assign({},l.state)),l.state=u.getMixedProps(l))),!d&&l.signals.beforeUpdate&&callListeners(l.signals.beforeUpdate),e._forceUpdate&&('all'===e._forceUpdate&&(r=!0),s=!0,delete e._forceUpdate),!d){const t=l.lastState;if(delete l.lastState,s||c||t){if(!s){const n=l.signals.shouldUpdate?askListeners(l.signals.shouldUpdate,[l,c,t],['first-true','no-false']):null;(!0===n||null==n&&HostServices.shouldUpdateBy(e,c,t))&&(s=!0)}const o='moved'===e._outerDef.action;if(o&&a.push([e,'moved']),s&&a.push([e,'updated',c,t]),o)for(const t of rootDOMTreeNodes(e.treeNode,!0,!0)){if(n){if(-1!==n.indexOf(t))continue;n.push(t)}i.push({treeNode:t,move:!0})}l.signals.preUpdate&&callListeners(l.signals.preUpdate,[c,t,s])}}if(s){const[t,n]=runBoundaryUpdate(e,r);i=i.concat(t),a=a.concat(n)}if(l.wired)for(const e of l.wired){if(e.api.onBuildProps){const t=e.api.builtProps;if(e.api.builtProps=e.api.onBuildProps(t),t===e.api.builtProps)continue}if(e.api.components.size){o||(o=new Set);for(const t of e.api.components)t.boundary._outerDef.props=Object.assign({},t.boundary._outerDef.props),o.add(t.boundary)}}if(o&&o.size){for(const t of o)t.sourceBoundary===e.sourceBoundary&&t._updateId!==e.host.services._whileUpdating&&(t._forceUpdate=!0,o.delete(t));const t=updatedInterestedInClosure(o,!0);i=i.concat(t[0]),a=a.concat(t[1])}return i[0]||a[0]?[i,a]:null}absorbChanges(e,t,n){var o;e&&this.renderCycle.pending.rInfos.push(e),t&&(this.host.settings.useImmediateCalls?HostServices.callBoundariesBy(t):this.renderCycle.pending.rCalls.push(t)),this.renderCycle.trigger(null!==(o=this.host.settings.renderTimeout)&&void 0!==o?o:void 0,null!=n?n:void 0)}static initializeCyclesFor(e){e.updateCycle.listenTo('onRefresh',((t,n)=>e.constructor.runUpdates(e,t,n))),e.renderCycle.listenTo('onRefresh',((t,n)=>e.constructor.runRenders(e,t,n))),e.updateCycle.listenTo('onFinish',(()=>{e.renderCycle.trigger(e.host.settings.renderTimeout)})),e.renderCycle.listenTo('onResolve',(()=>e.updateCycle.resolve()))}static runUpdates(e,t,n){if(!e._whileUpdating){for(;t.updates.size;){e._whileUpdating={};let n=[],o=[];for(const s of t.updates.size>1?sortBoundaries(t.updates):[...t.updates]){s._updateId=e._whileUpdating;const t=e.updateBoundary(s);t&&(n=n.concat(t[0]),o=o.concat(t[1]))}n[0]&&e.renderCycle.pending.rInfos.push(n),o[0]&&(e.host.settings.useImmediateCalls?HostServices.callBoundariesBy(o):e.renderCycle.pending.rCalls.push(o)),t=e.updateCycle.resetPending()}delete e._whileUpdating}}static runRenders(e,t,n){if(t.rInfos)for(const n of t.rInfos)n[0]&&e.renderer.applyToDOM(n);if(t.rCalls)for(const e of t.rCalls)e[0]&&HostServices.callBoundariesBy(e)}static shouldUpdateBy(e,t,n){var o,s,r;const i=e.component,a=e.host.settings.updateComponentModes,l=null===(o=i.constructor.api)||void 0===o?void 0:o.updateModes,d=t&&n?['props','state']:t?['props']:n?['state']:[];for(const e of d){const o=null!==(r=null!==(s=i.updateModes&&i.updateModes[e])&&void 0!==s?s:l&&l[e])&&void 0!==r?r:a[e],d='number'==typeof o?o:u[o]||0;if(d<-1){if(-2===d)return!0}else{if(0===d)return!0;if(!areEqual('state'===e?n:t,i[e],d))return!0}}return!1}static callBoundariesBy(e){for(const t of e){const[e,n,o,s]=t,r=e.component,i='mounted'===n?'didMount':'moved'===n?'didMove':'didUpdate';r.signals[i]&&callListeners(r.signals[i],'updated'===n?[o,s]:void 0)}}}class HostShadowAPI{constructor(){this.hosts=new Set,this.contexts={}}}class HostContextAPI extends ContextAPI{setContext(e,t,n=!0,o=!1){return o&&(t?this.host.shadowAPI.contexts[e]=t:delete this.host.shadowAPI.contexts[e]),void 0!==this.constructor.modifyContexts(this,{[e]:t},n,!1)[0]}setContexts(e,t=!0,n=!1){if(n){const t=this.host.shadowAPI.contexts;for(const n in e)e[n]?t[n]=e[n]:delete t[n]}return this.constructor.modifyContexts(this,e,t,!1)}awaitDelay(){return this.host.services.renderCycle.promise}afterRefresh(e,t,n){return this.host.services.triggerRefresh(t,n),e?this.awaitDelay():this.host.services.updateCycle.promise}static modifyContexts(e,t,n,o){const s=super.modifyContexts(e,t,n,o);for(const o of e.host.contextComponents)o.contextAPI.setContexts(t,n,!0);return s}}class Host{constructor(e,t,n,o,s){this.constructor.idCount++,this.shadowAPI=s||new HostShadowAPI,this.contextComponents=new Set,this.contextAPI=new HostContextAPI,this.contextAPI.host=this,o&&this.contextAPI.setContexts(o,!1,!0),this.groundedTree={type:'root',parent:null,children:[],domNode:t||null,sourceBoundary:null},this.settings=Host.getDefaultSettings(),n&&Host.modifySettings(this.settings,n),this.services=new HostServices(this);const r=newAppliedDef({MIX_DOM_DEF:'boundary',tag:this.services.createRoot(e),props:{},childDefs:[]},null),i={type:'boundary',def:r,sourceBoundary:null,boundary:null,parent:this.groundedTree,children:[],domNode:null};this.groundedTree.children.push(i),this.rootBoundary=new SourceBoundary(this,r,i),i.boundary=this.rootBoundary,this.rootBoundary.reattach(),this.services.absorbUpdates(this.rootBoundary,{})}clearRoot(e=!0,t,n){this.services.clearRoot(!0),e&&this.rootBoundary.update(!0,t,n)}moveRoot(e,t){if(this.groundedTree.domNode===e)return;this.groundedTree.domNode=e;const n=rootDOMTreeNodes(this.rootBoundary.treeNode,!0).map((e=>({treeNode:e,move:!0})));(n[0]||void 0!==t)&&this.services.absorbChanges(n,null,t)}updateRoot(e,t,n){this.services.updateRoot(e,t,n)}refreshRoot(e=!1,t,n){this.services.refreshRoot(e,t,n)}refreshDOM(e=!1,t){const n=!e||'read',o=[];let s,r=[...this.groundedTree.children],i=0;for(;s=r[i];)i+=1,s.domProps&&o.push({treeNode:s,refresh:n}),s.children[0]&&(r=s.children.concat(r.slice(i)),i=0);this.services.absorbChanges(o,null,t)}afterRefresh(e=!1,t,n){return new Promise((o=>this.afterRefreshCall(o,e,t,n)))}updateRefreshTimes(e,t){this.services.updateRefreshTimes(e,t)}afterRefreshCall(e,t=!1,n,o){this.services.hasPending(!0,t)?(this.addRefreshCall(e,t),this.services.triggerRefresh(n,o)):e()}addRefreshCall(e,t=!1){this.services.addRefreshCall(e,t)}triggerRefresh(e,t){this.services.triggerRefresh(e,t)}pause(){this.services.renderer.pause()}resume(){this.services.renderer.resume()}isPaused(){return this.services.renderer.paused}reassimilate(e=null,t=!1,n=!1,o=!1,s,r){this.services.renderer.reassimilate(e||this.groundedTree.domNode,t,n,o,s,r)}reassimilateWith(e,t=null,n=!1,o=!1,s=!1,r,i){this.pause(),this.updateRoot(e,null,null),this.services.renderer.reassimilate(t||this.groundedTree.domNode,n,o,s,r,i)}remount(e=null,t=!1,n=!0,o,s){return this.remountWith(this.services.getRootDef(!0),e,t,n,o,s)}remountWith(e,t=null,n=!1,o=!0,s,r){null==e&&(e=this.services.getRootDef(!0));const i=t&&HostRender.createVirtualItemsFor(t);this.clearRoot(!0,null,null);const a=this.settings.debugMode||void 0,l=this.services.renderer,d=l.sourceRemount=i?Object.assign(Object.assign({},i),{reused:a&&new Set,created:a&&new Set,unused:a&&new Set,readFromDOM:n,removeUnused:o,validator:s,suggester:r}):void 0;if(this.services.updateRoot(e,null,null),delete l.sourceRemount,a&&d)return{created:d.created,reused:d.reused,unused:d.unused}}readDOMString(){return HostRender.readDOMString(this.rootBoundary.treeNode)}getRootDef(){return this.services.getRootDef(!0)}getContainerElement(){return this.groundedTree.domNode}getRootElement(){return this.rootBoundary&&this.rootBoundary.treeNode.domNode}getRootElements(e){return this.rootBoundary?rootDOMTreeNodes(this.rootBoundary.treeNode,e,!1).map((e=>e.domNode)):[]}queryElement(e,t=!1){return domElementByQuery(this.groundedTree,e,!0,t)}queryElements(e,t=0,n=!1){return domElementsByQuery(this.groundedTree,e,t,!0,n)}findElements(e=0,t=!1,n){return treeNodesWithin(this.groundedTree,new Set(['dom']),e,!0,t,n).map((e=>e.domNode))}findComponents(e=0,t=!1,n){return treeNodesWithin(this.groundedTree,new Set(['boundary']),e,!0,t,n).map((e=>e.boundary&&e.boundary.component))}findTreeNodes(e,t=0,n=!1,o){const s=e.constructor===Set?e:e.constructor===Array?new Set(e):new Set(Object.keys(e));return treeNodesWithin(this.groundedTree,s,t,!0,n,o)}modifySettings(e,t=!0){const n=this.settings.onlyRunInContainer;if(Host.modifySettings(this.settings,e),void 0!==e.onlyRunInContainer&&e.onlyRunInContainer!==n&&this.refreshRoot(!1,null,null),t)for(const t of this.shadowAPI.hosts)t!==this&&t.modifySettings(e,!1)}static modifySettings(e,t,n=!1){var o;let s=null;if(t.updateComponentModes){const e=t.updateComponentModes,n={};for(const t in e)n[t]=null!==(o=e[t])&&void 0!==o?o:(s||(s=Host.getDefaultSettings())).updateComponentModes[t];t=Object.assign(Object.assign({},t),{updateComponentModes:n})}for(const o in t)void 0!==t[o]?e[o]=t[o]:n&&(e[o]=(s||(s=Host.getDefaultSettings()))[o])}static getDefaultSettings(){return{updateTimeout:0,renderTimeout:0,useImmediateCalls:!1,updateComponentModes:{props:'shallow',state:'shallow'},preCompareDOMProps:'if-needed',wideKeysInArrays:!1,noRenderValuesMode:!1,onlyRunInContainer:!1,disableRendering:!1,duplicateDOMNodeBehaviour:'deep',duplicateDOMNodeHandler:null,duplicatableHost:!1,maxReRenders:1,renderTextTag:'',renderHTMLDefTag:'span',renderTextHandler:null,renderSVGNamespaceURI:'http://www.w3.org/2000/svg',renderDOMPropsOnSwap:!0,debugMode:!1}}}Host.MIX_DOM_CLASS='Host',Host.idCount=0;class PseudoFragment{constructor(e){}}PseudoFragment.MIX_DOM_CLASS='Fragment';class PseudoPortal{constructor(e){}}PseudoPortal.MIX_DOM_CLASS='Portal';class PseudoElement{constructor(e){}}PseudoElement.MIX_DOM_CLASS='Element';class PseudoEmpty{constructor(e){}render(){return null}}PseudoEmpty.MIX_DOM_CLASS='Empty';class PseudoEmptyRemote extends PseudoEmpty{constructor(e,t){super(e,t)}static isRemote(){return!1}}PseudoEmptyRemote.MIX_DOM_CLASS='EmptyRemote',PseudoEmptyRemote.Content=null,PseudoEmptyRemote.ContentCopy=null,PseudoEmptyRemote.copyContent=e=>null,PseudoEmptyRemote.filterContent=(e,t)=>null,PseudoEmptyRemote.wrapContent=(e,t)=>null,PseudoEmptyRemote.renderContents=e=>null,PseudoEmptyRemote.hasContent=e=>!1,PseudoEmptyRemote.WithContent=(e,t)=>null,PseudoEmptyRemote.sources=[];class ComponentShadowAPI extends SignalBoy{constructor(){super(...arguments),this.components=new Set}update(e=!0,t,n){for(const o of this.components)o.triggerUpdate(e,t,n)}static onListener(e,t,n,o){if(e.components.size&&e.signals[t]){const s=e.signals[t][n],r=s[0];if(o)for(const n of e.components)n.listenTo(t,((...e)=>s[1]?r(n,...e,...s[1]):r(n,...e)),null,s[2],r);else for(const n of e.components)n.unlistenTo(t,r)}}}function prepareShadow(e,t,n){if(n)for(const t in n)e[t]=n[t];if(e.api=new ComponentShadowAPI,t)for(const n in t)e.api.listenTo(n,t[n])}class ComponentWiredAPI extends ComponentShadowAPI{constructor(){super(),this.updateModes={props:'never'},this.builtProps=null}buildProps(){return this.onBuildProps?this.onBuildProps(this.builtProps):this.builtProps}getMixedProps(e){return this.onMixProps?this.onMixProps(e.props,this.builtProps,e):Object.assign(Object.assign({},e.props),e.state)}setProps(e,t,n,o){(this.builtProps!==e||t||void 0!==n||void 0!==o)&&(this.builtProps=e,this.update('trigger'!==t&&t,n,o))}refresh(e,t,n){this.setProps(this.buildProps(),e,t,n)}update(e=!0,t,n){for(const o of this.components)o.setState(this.getMixedProps(o),!1,e,t,n)}}var m;const checkRecursively=e=>{var t;return!(!(null===(t=e.contentPass)||void 0===t?void 0:t.envelope)||!hasContentInDefs(e.contentPass.envelope.applied.childDefs,checkRecursively))},g=((m=class WithContent extends Component{hasContent(){var e;const t=null===(e=this.boundary.sourceBoundary)||void 0===e?void 0:e.closure;return t&&t.envelope&&hasContentInDefs(t.envelope.applied.childDefs,checkRecursively)||!1}render(){var e;return(null!==(e=this.props.hasContent)&&void 0!==e?e:this.hasContent())?a:null}})._WithContent=a,m);function mergeShadowWiredAPIs(e){const t=e.some((e=>e instanceof ComponentWiredAPI))?new ComponentWiredAPI:new ComponentShadowAPI;for(const n of e){if(n.updateModes){t.updateModes||(t.updateModes={});for(const e in n.updateModes)t.updateModes[e]=Object.assign(Object.assign({},t.updateModes[e]),n.updateModes[e])}for(const e in n.signals)t.signals[e]=[...t.signals[e]||[],...n.signals[e]];n instanceof ComponentWiredAPI&&(n.builtProps&&(t.builtProps=n.builtProps),n.onBuildProps&&(t.onBuildProps=n.onBuildProps),n.onMixProps&&(t.onMixProps=n.onMixProps))}return t}function mixFuncs(...e){const t=e.length,n=!0===e[t-1],o=n||!e[t-1]?e.slice(0,t-1):e,CompFunc=(e,t,s)=>{let r=null;for(const n of o){if(!n)continue;const o=t.state,i=n(e,t,s);'function'!=typeof i&&'function'==typeof r||(r=i),o!==t.state&&t.state&&(t.state=Object.assign(Object.assign({},o||{}),t.state))}return n?()=>r:r},s=o.some((e=>e.length>2))?(e,t,n)=>CompFunc(e,t,n):(e,t)=>CompFunc(e,t),r=[];for(const e of o)for(const t in e)'api'===t?r.push(e.api):s[t]=e[t];return r[0]&&(s.api=mergeShadowWiredAPIs(r)),s}function mixMixins(...e){const t=e[0].MIX_DOM_CLASS?e[0]:null;let n=t||Component;for(const o of t?e.slice(1):e)n=o(n);return n}function mixClassFuncs(e,...t){const n='function'!=typeof t[t.length-1]&&!!t.pop(),o=t.length>1?mixFuncs(...t):t[0],s={[e.name]:class extends e{render(e){const t=o(e,this,this.contextAPI);return n?super.render:'function'==typeof t?t:()=>t}}}[e.name];for(const e in o)'api'===e?s.api=s.api?mergeShadowWiredAPIs([s.api,o.api]):o.api:s[e]=o[e];return s}const y={def:newDef,defHTML:function newDefHTML(e,t,n,o){const s={MIX_DOM_DEF:'content',tag:t||'',childDefs:[],domContent:e,domHTMLMode:!0};return t&&n&&(s.props=cleanDOMProps(n)),null!=o&&(s.key=o),s},Content:a,WithContent:g,ContentCopy:l,copyContent:function newContentCopyDef(e){return newContentPassDef(e,!0)},Component,Host,Ref,Fragment:PseudoFragment,Portal:PseudoPortal,Element:PseudoElement,Empty:PseudoEmpty,EmptyRemote:PseudoEmptyRemote,component:createComponent,componentCtx:createComponentCtx,shadow:function createShadow(e,t,...n){const o=n[0]&&'object'==typeof n[0]?n[0]:void 0,s=(o?n[1]:n[0])||e.name||'[createShadow]',r=e.MIX_DOM_CLASS?{[s]:class extends e{}}[s]:createComponent(e,s);return prepareShadow(r,t,o),r},shadowCtx:(e,t,...n)=>{const o=n[0]&&'object'==typeof n[0]?n[0]:void 0,s=createComponentCtx(e,(o?n[1]:n[0])||e.name||'[createShadowCtx]');return prepareShadow(s,t,o),s},spread:e=>e.length>1?function(t,...n){return e(t,...n)}:e,spreadWith:e=>e.length>1?function(t,...n){return e(t,...n)}:e,remote:(e='Remote')=>{const t='WithContent',n={[e]:class extends Component{constructor(){super(...arguments),this.closure=new ContentClosure(null,this.boundary),this.Content=Object.assign(Object.assign({},newContentPassDef(this)),{contentPass:null,getRemote:()=>this}),this.ContentCopy=Object.assign(Object.assign({},newContentPassDef(this,!0)),{contentPass:null,getRemote:()=>this}),this.copyContent=e=>Object.assign(Object.assign({},newContentPassDef(null!=e?e:n,!0)),{contentPass:null,getRemote:()=>this}),this.hasContent=()=>this.closure.hasContent(),this.WithContent=(()=>{const n=this,o={[e+'[i].'+t]:class extends Component{render(){return(null!=this.props.hasContent?this.props.hasContent:n.hasContent())?a:null}}}[e+'[i].'+t];return o._WithContent=n.Content,o})()}render(){return null}static isRemote(){return!0}static addSource(e,t=e.props.order){const s=n.sources.indexOf(e),r=orderedIndex(t,n.sources.map((e=>e.props.order)));if(-1===s);else{if(-1===r?s===n.sources.length-1:s===r)return;n.sources.splice(s,1)}-1===r?n.sources.push(e):n.sources.splice(r,0,e);for(const t of o.passers)t.boundary.host===e.boundary.host?t.boundary.update(!0):t.boundary.host.addRefreshCall((()=>t.boundary.update(!0,null,null)),!0)}static removeSource(e){const t=n.sources.indexOf(e);if(-1===t)return null;n.sources.splice(t,1);let s=null;const r=collectInterestedInClosure(e.closure,e);s=function applyClosureEnvelope(e,t){const n=preRefreshClosure(e,t),o=n&&updatedInterestedInClosure(n),s=applyClosureRefresh(e);return o?[o[0].concat(s[0]),o[1].concat(s[1])]:s}(e.closure,null),e.closure.sourceBoundary=null;for(const t of o.passers)t.boundary.host===e.boundary.host?t.boundary.update(!0):t.boundary.host.addRefreshCall((()=>t.boundary.update(!0,null,null)),!0);return r&&e.boundary.host.addRefreshCall((()=>{for(const e of r)e.update(!0,null,null)}),!0),s}}}[e],o={[e+'.Passer']:class extends Component{constructor(e,t){super(e,t),this.constructor.passers.add(this),this.listenTo('willUnmount',(()=>this.constructor.passers.delete(this)))}render(e){return e.renderer?e.renderer(n.sources.slice()):{tag:null,MIX_DOM_DEF:'fragment',childDefs:e.wrapper?n.sources.map(((t,n)=>e.wrapper?newDefFrom(e.wrapper(t,n)):null!=e.copyKey?t.copyContent(e.copyKey):e.copy?t.ContentCopy:t.Content)).filter((e=>e)):(e.filterer?n.sources.filter(e.filterer):n.sources).map((t=>null!=e.copyKey?t.copyContent(e.copyKey):e.copy?t.ContentCopy:t.Content))}}}}[e+'.Passer'];o.passers=new Set;const s=newDef(o),r={[e+'.'+t]:class extends Component{constructor(e,t){super(e,t),this.constructor.withContents.add(this.boundary),this.listenTo('willUnmount',(()=>this.constructor.withContents.delete(this.boundary)))}render(){return(null!=this.props.hasContent?this.props.hasContent:n.hasContent())?a:null}}}[e+'.'+t];return r._WithContent=s,r.withContents=new Set,n.MIX_DOM_CLASS='Remote',n.sources=[],n.ContentPasser=o,n.Content=s,n.ContentCopy=newDef(o,{copy:!0}),n.copyContent=e=>newDef(o,{copy:!0,copyKey:e}),n.hasContent=e=>e?n.sources.some(((t,n)=>e(t,n)&&t.closure.hasContent())):n.sources.some((e=>e.closure.hasContent())),n.filterContent=(e,t)=>newDef(o,{copyKey:t,filterer:e}),n.wrapContent=(e,t)=>newDef(o,{copyKey:t,wrapper:e}),n.renderContents=e=>newDef(o,{renderer:e}),n.WithContent=r,n},wired:function createWired(...e){const t=e.length,n='string'==typeof e[t-1]?-1:0,o=e[t-3+n],s=e[t-2+n]||null,r=e[t-1+n],i=n?e[t-1]:r.name||'[createWired]',l={[i]:function(e,t){return newDef(r,Object.assign({},t.state),a)}}[i];return l.api=new ComponentWiredAPI,o&&('object'==typeof o?l.api.builtProps=o:t>2&&'function'==typeof o&&(l.api.onBuildProps=o)),s&&(l.api.onMixProps=s),l},mixin:function createMixin(e){return e},mixinComponent,mixFuncs,mixFuncsWith:function mixFuncsWith(...e){const t=e.length;return'function'!=typeof e[t-1]?mixFuncs(...e.slice(0,t-1),!0):mixFuncs(...e,!0)},mixClassFuncs,mixClassFuncsWith:function mixClassFuncsWith(...e){const t=e.length;return mixClassFuncs(...'function'!=typeof e[t-1]?e.slice(0,t-1):e)},mixClassMixins:function mixClassMixins(...e){return mixMixins(...e)},mixMixins,mixMixinsWith:function mixMixinsWith(...e){const t=e.length;return'function'!=typeof e[t-1]?mixMixins(...e.slice(0,t-1)):mixMixins(e)},mixHOCs:function mixHOCs(e,...t){let n=e;for(const e of t)n=e(n);return e=>newDef(n,e,a)},findTreeNodesIn:(e,t,n,o,s,r)=>treeNodesWithin(e,t?t.constructor===Set?t:t.constructor===Array?new Set(t):new Set(Object.keys(t)):void 0,n,o,s,r),findComponentsIn:(e,t,n,o,s)=>treeNodesWithin(e,new Set(['boundary']),t,n,o,s).map((e=>e.boundary&&e.boundary.component)),findElementsIn:(e,t,n,o,s)=>treeNodesWithin(e,new Set(['dom']),t,n,o,s).map((e=>e.domNode)),queryElementIn:(e,t,n,o)=>domElementByQuery(e,t,n,o),queryElementsIn:(e,t,n,o,s)=>domElementsByQuery(e,t,n,o,s),readDOMString:(e,n=!1,o=-1,s=t)=>{const r=e&&(e.constructor.MIX_DOM_CLASS?e.boundary.treeNode:e.treeNode||'string'==typeof e.type&&e);return r?HostRender.readDOMString(r,n,o,s):''}};var D=Object.freeze({__proto__:null,mixins:function mixins(...e){return e.reduce(((e,t)=>t(e)),Object)},mixinsWith:function mixinsWith(e,...t){return t.reduce(((e,t)=>t(e)),e)}});window.MixDOM=y,window.DataSignals=c,window.DataMemo=h,window.MixinTypes=D,window.DOMTypes=r}();
